{"version":3,"sources":["frontend/redux-state/classification/classificationReducer.ts","backend/workers/aiWorker/workerProcedures/vectorizers/tfidf.ts","backend/workers/docIndex/indexWorkerTypes.ts","backend/workers/docIndex/ndx_worker.ts","backend/workers/common/datatypes.ts","backend/utils/logger.ts","backend/workers/common/BaseWorker.ts","backend/workers/docIndex/IndexWorkerSingleton.ts","frontend/redux-state/examples/exampleState.ts","frontend/QueryContext/searchReducer.ts","frontend/redux-state/modes/modeReducer.ts","frontend/redux-state/rootState.ts","backend/database/database.ts","frontend/QueryContext/useSearchQuery.tsx","frontend/components/Beacon.tsx","frontend/components/searchBar/SearchBar.tsx","frontend/components/searchBar/FilterCheckboxes.tsx","backend/database/useDatabase.ts","frontend/components/appBar/ActiveLearningToggleContainer.tsx","frontend/components/appBar/DownloadButton.tsx","frontend/components/appBar/DeleteAllButton.tsx","frontend/components/appBar/ForkOnGithub.tsx","frontend/components/appBar/Appbar.tsx","frontend/components/layouts/templates/ThreeColumnBody.tsx","frontend/utils/labelsetcolors/labelsetcolors.ts","frontend/components/labelControls/significantTerms/SignificantTerm.tsx","frontend/components/labelControls/significantTerms/SignificantTermsList.tsx","frontend/components/labelControls/significantTerms/SignificantTermsContainer.tsx","frontend/components/labelControls/SelectedLabelToggle.tsx","frontend/components/labelControls/LabelRow.tsx","controllers/labelControllers/DefaultLabelController.ts","frontend/components/labelControls/labelControls.tsx","frontend/active_learning/useActiveLearning.ts","frontend/active_learning/ActiveLearningContext.tsx","backend/workers/aiWorker/ai_worker.ts","backend/workers/aiWorker/aiWorkerTypes.ts","backend/workers/aiWorker/AIWorkerSingleton.ts","backend/database/dbProcesdures.ts","frontend/components/example/ClassificationRibbon.tsx","frontend/components/example/Example.tsx","frontend/active_learning/ActiveLearningBody.tsx","frontend/classifier/workerComp.tsx","frontend/components/layouts/ExampleInfiniteScroll.tsx","frontend/components/dataUpload/fileReader.ts","frontend/components/dataUpload/simpleDataUpload.tsx","frontend/components/dataUpload/AddDataDialog.tsx","frontend/components/layouts/OpenAnnotationBodyLayout.tsx","frontend/components/layouts/WelcomeLayout.tsx","frontend/components/layouts/LayoutDispatch.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["ClassificationActions","classificationSlice","createSlice","name","initialState","classifications","labels","labelsToExample","reducers","addLabel","state","action","includes","payload","push","deleteLabel","filter","x","forEach","exampleId","classify","labelName","currentLabel","undefined","actions","Counter","this","items","key","val","get","tokenizingRegex","doExample","example","tf","df","Set","content","split","word","match","increment","add","TFIDFTransformer","examples","minDF","ex_res","tfIdf","Object","keys","Math","log1p","calculateTFIDF","IndexRequestMessageKind","IndexResponseMessageKind","Request","Response","NSIndexWorker","Worker","EWorkerName","ERquestOrResponesOrUpdate","GenericWorkerTypes","logger","WorkerSingletonBase","workerInstance","initialized","requestId","responseListeners","worker","jobCount","event","postMessage","Promise","resolve","responseHandler","data","kind","removeEventListener","addEventListener","IndexWorkerSingleton","indexName","nextRequestId","message","workerName","index","direction","request","startInit","me","registerResponseHandler","then","response","startIndexing","startWork","Error","startDataInsert","addDocs","buildIndex","reject","startSignificantTerms","query","startQuery","instance","a","indexWorkerSingleton","getInstance","insertAndIndex","ExampleActions","exampleReducer","exampleIds","exampleIdsByDatasetName","exampleTermFrequency","docFrequency","addExamples","fitTransform","datasetName","datasetSlice","reducer","SearchTypes","searchSlice","hasLabel","hasPrediction","label","searchQuery","predictedLabel","hasFilter","everSearched","setSearchParams","entries","params","value","appModeSlice","mode","changeMode","enableMapSet","enableAllPlugins","rootReducer","combineReducers","classificationReducer","searchReducer","appMode","persistConfig","storage","persistedReducer","persistReducer","store","configureStore","middleware","getDefaultMiddleware","serializableCheck","ignoredActions","FLUSH","REHYDRATE","PAUSE","PERSIST","PURGE","REGISTER","persistStore","useTypedSelector","useSelector","OurDatabase","version","stores","indexCache","vector","tfidf","kfold","table","changeCallbacks","tableName","callback","Dexie","difference","mainThreadDB","where","equals","first","newCount","count","update","on","changes","labelChangeAccumulator","change","type","oldLabel","oldObj","newLabel","obj","gatherLabelChangeCount","all","map","updateLabelCount","length","initatiateMainThreadDB","useSearchQuery","searchParams","searchFunction","React","useCallback","criteria","filterFunction","toCollection","primaryKeys","filterResult","searchResults","results","intersection","useQuery","useStyles","makeStyles","theme","webkitTransform","opacity","transform","beaconContainer","position","beacon","top","left","backgroundColor","palette","secondary","light","height","spacing","width","borderRadius","boxShadow","main","animationName","animationDuration","animationTimingFunction","animationIterationCount","Beacon","show","classes","className","inputRoot","color","inputInput","padding","paddingLeft","transition","transitions","create","breakpoints","up","resultCount","margin","fontWeight","search","shape","fade","common","white","marginRight","marginLeft","searchIcon","pointerEvents","display","alignItems","justifyContent","SearchBar","useState","setValue","dispatch","useDispatch","debouncedUpdate","debounce","e","target","useEffect","InputBase","placeholder","onChange","root","input","inputProps","endAdornment","InputAdornment","Fade","in","isLoading","LinearProgress","icon","checkedIcon","FilterCheckboxes","props","FormGroup","row","style","FormControlLabel","labelPlacement","control","Checkbox","checked","v","fontSize","size","useDatabase","queryKey","dbQuery","changeKey","resetQueryCallback","refetch","addTableEventListener","removeTableEventListener","useExampleCount","db","ActiveLearningToggleContainer","predictionCountQuery","Switch","nextMode","downloadResults","orderBy","reverse","toArray","metaDataKeys","metadata","columns","formatedExamples","ex","csv","Papa","fields","fileDownload","DownloadButton","useMutation","downloadFunc","downloadStatus","Button","variant","onClick","disabled","header","background","error","contrastText","button","dark","handleDelete","delete","localStorage","removeItem","window","location","reload","DeleteAllButton","open","setOpen","Dialog","onClose","DialogTitle","Typography","DialogContent","gutterBottom","DialogActions","animation","ForkOnGithub","href","aria-label","viewBox","fill","border","right","aria-hidden","d","transformOrigin","createStyles","grow","flexGrow","regularModeControls","menuButton","title","sectionDesktop","sectionMobile","PrimarySearchAppBar","anchorEl","setAnchorEl","mobileMoreAnchorEl","setMobileMoreAnchorEl","isMenuOpen","Boolean","isMobileMenuOpen","isActiveLearning","exampleCountQuery","hasExamples","handleMobileMenuClose","handleMenuClose","renderMenu","Menu","anchorOrigin","vertical","horizontal","id","keepMounted","MenuItem","mobileMenuId","renderMobileMenu","IconButton","Badge","badgeContent","currentTarget","aria-controls","aria-haspopup","AppBar","Toolbar","edge","noWrap","Slide","ThreeColumnBody","useTheme","orientation","propagateDimensions","flex","maxHeight","overflowY","Left","maxWidth","Middle","Right","LabselsetColorsManager","colormap","has","recolor","h","step","H","S","L","rgb","HSL2RGB","RGB2HEX","HSLToHex","RGBArray","hex","toString","q","p","round","colorManaer","cursor","term","score","SignificantTerm","searchForTerm","SignificantTermsList","terms","slice","ws","SignificantTermsContainer","labelController","getSignificantTerms","cacheTime","isError","JSON","stringify","isSuccess","SelectedLabelToggle","memo","filteredLabel","changeLabelFilter","filteredPrediction","marginBottom","textOverflow","userSelect","marginTop","nameContainer","textTransform","termsContainer","borderBottom","controlorContainers","toggleButton","LabelRow","getLabelColor","useMemo","borderColor","selected","applyLabelToSearchResults","useDefaultLabelController","transaction","labelState","useAnnotateAll","getSignificantTermsForLabel","source","AddLabel","labelCount","setName","TextField","fullWidth","InputProps","startAdornment","LabelControls","flexWrap","useActiveLearning","collection","sortBy","confidence","ActiveLearningContext","createContext","ActiveLearningContextProvider","activeLearningExamplesQuery","currentExample","setCurrentExample","currentCursor","setCurrentCursor","activeLearningExamples","goToNext","nextCursor","Provider","children","AIRequestMessageKind","AIResponseMessageKind","AIUpdateMessageKind","Update","NSAIWorker","AIWorkerSingleton","ai","training","method","startVectorize","beginVectorization","startValidation","startFitPredict","beginFitPredict","rejectLabel","rejectedLabels","hasNegativeOrRejectedLabel","Array","from","afterNewLabel","applyLabel","cbRoot","ClassBox","activeLearningContext","useContext","handleClick","onKeyDown","keyCode","preventDefault","comment","ClassificationRibbon","lineHeight","body","whiteSpace","divider","ribbon","HighlightedBody","text","spans","toLowerCase","end","tabIndex","Example","exampleQuery","onLoad","Paper","LabselsetColors","Divider","toLocaleString","dir","ActiveLearningBody","ref","useRef","context","current","focus","aiWorkerSingleton","WorkComp","working","setWorking","beginTfidfVectorizer","vectorize","beginUniversalVectorizer","trainSVM","validateModel","beginValidation","cache","CellMeasurerCache","fixedWidth","ExampleRenderer","columnIndex","virtualizedRowProps","parent","rowIndex","measure","ExampleInfiniteScroll","rowHeight","rowCount","rowRenderer","renderProps","deferredMeasurementCache","readCsvFile","file","parseConfig","headerPlacement","dynamicTyping","complete","result","skipEmptyLines","readJSONAsynch","reader","FileReader","onload","str","json","parse","isArray","readAsText","readUserInputFile","endsWith","papaParseResult","saveExamplesfn","labelKey","examplesArr","md5","FileUploadButton","inputRef","setKeys","setKey","setLabelKey","setData","saveExamples","saveStatus","handleFile","files","res","afterSubmit","Grid","container","item","xs","accept","multiple","htmlFor","component","required","select","helperText","k","AddDataDialog","AddDataDialogWithButton","buttonProps","NoDataBody","RegularBody","mountOnEnter","unmountOnExit","BodyDispatch","OpenAnnotationBody","WelcomeItem","justify","Icon","subtitle","WelcomeText","openDialog","align","CategoryIcon","DescriptionIcon","SearchIcon","ComputerIcon","DoneIcon","LockIcon","GithubIcon","WelcomeLayout","LayoutDispatch","createMuiTheme","typography","fontFamily","QueryCache","outline","App","queryCache","ThemeProvider","CssBaseline","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","initializeIndex","catch","err","offset","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.efbf88e7.chunk.js","sourcesContent":["import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\nnamespace ClassificationActions {\n  export interface ClassificationState {\n    classifications: Record<string, string>;\n    labels: Array<string>;\n    labelsToExample: Record<string, Array<string>>;\n  }\n\n  export interface ANewLabel {\n    name: string;\n  }\n\n  export interface ADeleteLabel {\n    name: string;\n  }\n\n  export interface AClassify {\n    exampleId: string;\n    labelName: string | null; // null is delete\n  }\n}\n\nfunction initialStateFactory(): ClassificationActions.ClassificationState {\n  return {\n    classifications: {},\n    labels: [],\n    labelsToExample: {},\n  };\n}\n\nconst classificationSlice = createSlice({\n  name: \"classificationSlice\",\n  initialState: initialStateFactory(),\n  reducers: {\n    addLabel(state, action: PayloadAction<ClassificationActions.ANewLabel>) {\n      if (!state.labels.includes(action.payload.name)) {\n        state.labels.push(action.payload.name);\n        state.labelsToExample[action.payload.name] = [];\n      }\n    },\n    deleteLabel(\n      state,\n      action: PayloadAction<ClassificationActions.ADeleteLabel>\n    ) {\n      state.labels = state.labels.filter((x) => x !== action.payload.name);\n      const exampleIdsToClear = state.labelsToExample[action.payload.name];\n      exampleIdsToClear.forEach((exampleId) => {\n        delete state.classifications[exampleId];\n      });\n      delete state.labelsToExample[action.payload.name];\n    },\n    classify(state, action: PayloadAction<ClassificationActions.AClassify>) {\n      const { exampleId, labelName } = action.payload;\n      const currentLabel = state.classifications[exampleId];\n\n      if (currentLabel === labelName) {\n        //do nothing\n      } else {\n        if (currentLabel !== undefined) {\n          //clear the old label\n          state.labelsToExample[currentLabel] = state.labelsToExample[\n            currentLabel\n          ].filter((x) => x !== exampleId);\n        }\n        if (labelName !== null) {\n          //If the user added a classification\n\n          state.labelsToExample[labelName].push(exampleId);\n          state.classifications[exampleId] = labelName;\n        } else {\n          //If the user deleted a classification\n          delete state.classifications[exampleId];\n        }\n      }\n    },\n  },\n});\n\nexport const classificationActions = classificationSlice.actions;\n\nexport default classificationSlice.reducer;\n","import Data from \"../../../../data_clients/datainterfaces\";\n\nexport class Counter {\n  items: Record<string, number>;\n\n  constructor() {\n    this.items = {};\n  }\n\n  get(key: string) {\n    return this.items[key] || 0;\n  }\n\n  increment(key: string) {\n    const val = this.get(key);\n    this.items[key] = val + 1;\n  }\n}\n\nexport const tokenizingRegex = /[\\b\\s-.,!&:]+(?!$)/;\nexport type TFIDFT = Record<string, Record<string, number>>;\n\nfunction doExample(example: Data.Example) {\n  const tf = new Counter();\n  const df = new Set<string>();\n\n  example.content.split(tokenizingRegex).forEach((word) => {\n    if (!word.match(/[\\d]/)) {\n      tf.increment(word);\n      df.add(word);\n    }\n  });\n  return { df, tf };\n}\n\nfunction calculateTFIDF(examples: Data.Example[], minDF = 4) {\n  const tf: Record<string, Counter> = {};\n  const df = new Counter();\n  examples.forEach((example) => {\n    //Calculate the df\n\n    const ex_res = doExample(example);\n    ex_res.df.forEach((word) => {\n      df.increment(word);\n    });\n    tf[example.exampleId] = ex_res.tf;\n  });\n  const tfIdf: TFIDFT = {};\n  examples.forEach((example) => {\n    tfIdf[example.exampleId] = {};\n\n    Object.keys(df.items).forEach((word) => {\n      if (df.get(word) > minDF) {\n        tfIdf[example.exampleId][word] = Math.log1p(\n          tf[example.exampleId].get(word) / df.get(word)\n        );\n      }\n    });\n  });\n  return { tfIdf, df };\n}\n\nclass TFIDFTransformer {\n  df: Counter;\n\n  constructor() {\n    this.df = new Counter();\n  }\n\n  fitTransform(examples: Data.Example[]) {\n    const { tfIdf, df } = calculateTFIDF(examples);\n    this.df = df;\n    return tfIdf;\n  }\n\n  transform(examples: Data.Example[]) {\n    const tfIdf: TFIDFT = {};\n    const tf: Record<string, Counter> = {};\n\n    examples.forEach((example) => {\n      //Calculate the df\n      const ex_res = doExample(example);\n      tf[example.exampleId] = ex_res.tf;\n    });\n\n    examples.forEach((example) => {\n      tfIdf[example.exampleId] = {};\n      Object.keys(this.df.items).forEach((word) => {\n        tfIdf[example.exampleId][word] = Math.log1p(\n          tf[example.exampleId].get(word) / this.df.get(word)\n        );\n      });\n    });\n  }\n}\n\nexport default TFIDFTransformer;\n","import Data from \"../..//data_clients/datainterfaces\";\nimport { GenericWorkerTypes } from \"../common/datatypes\";\n\nexport type SignificantTerm = { word: string; score: number };\nexport namespace NSIndexWorker {\n  export enum IndexRequestMessageKind {\n    startIndexing = \"startIndexing\",\n    startQuery = \"startQuery\",\n    startInit = \"startInit\",\n    startSignificantTerms = \"startSignificantTerms\",\n    startDataInsert = \"startDataInsert\",\n  }\n\n  export enum IndexResponseMessageKind {\n    endIndexing = \"endIndexing\",\n    endQuery = \"endQuery\",\n    endInit = \"endInit\",\n    endSignificantTerms = \"endSignificantTerms\",\n    endDataInsert = \"endDataInsert\",\n  }\n\n  interface IndexEventBase extends GenericWorkerTypes.GenericEvent {\n    workerName: GenericWorkerTypes.EWorkerName.index;\n    requestId: number;\n    payload: unknown;\n  }\n\n  type RequestEvent = IndexEventBase &\n    GenericWorkerTypes.RequestEvent & {\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request;\n      kind: IndexRequestMessageKind;\n    };\n  type ResponseEvent = IndexEventBase &\n    GenericWorkerTypes.ResponseEvent & {\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.response;\n      kind: IndexResponseMessageKind;\n    };\n  export type SearchResult = {\n    exampleId: string;\n    score: number;\n  };\n  export namespace Request {\n    export interface IStartIndex extends RequestEvent {\n      kind: IndexRequestMessageKind.startIndexing;\n      payload: {};\n    }\n\n    export interface IStartQuery extends RequestEvent {\n      kind: IndexRequestMessageKind.startQuery;\n      payload: {\n        query: string;\n      };\n    }\n\n    export interface IStartInit extends RequestEvent {\n      kind: IndexRequestMessageKind.startInit;\n      payload: {\n        indexName?: string;\n      };\n    }\n\n    export interface IStartSignificantTerms extends RequestEvent {\n      kind: IndexRequestMessageKind.startSignificantTerms;\n      payload: {\n        labelName: string;\n      };\n    }\n\n    export interface IStartDataInsert extends RequestEvent {\n      kind: IndexRequestMessageKind.startDataInsert;\n      payload: {\n        examples: Data.Example[];\n      };\n    }\n\n    export type TRequests =\n      | IStartQuery\n      | IStartIndex\n      | IStartInit\n      | IStartDataInsert\n      | IStartSignificantTerms;\n  }\n  export namespace Response {\n    export interface IEndIndex extends ResponseEvent {\n      kind: IndexResponseMessageKind.endIndexing;\n      payload: {\n        numInserted: number;\n      };\n    }\n\n    export interface IEndQuery extends ResponseEvent {\n      kind: IndexResponseMessageKind.endQuery;\n      payload: {\n        results: SearchResult[];\n      };\n    }\n\n    export interface IEndInit extends ResponseEvent {\n      kind: IndexResponseMessageKind.endInit;\n      payload: {\n        numIndexed: number;\n      };\n    }\n\n    export interface IEndSignificantTerms extends ResponseEvent {\n      kind: IndexResponseMessageKind.endSignificantTerms;\n      payload: {\n        terms: SignificantTerm[];\n        labelName: string;\n      };\n    }\n    export interface IEndDataInsert extends ResponseEvent {\n      kind: IndexResponseMessageKind.endDataInsert;\n      payload: {\n        numInserted: number;\n      };\n    }\n\n    export type TResponse =\n      | IEndQuery\n      | IEndIndex\n      | IEndInit\n      | IEndDataInsert\n      | IEndSignificantTerms;\n  }\n\n  export interface IIndexSingelton {\n    addDocs: (docs: Data.Example[]) => Promise<{ numInserted: number }>;\n    query: (query: string) => Promise<{ results: SearchResult[] }>;\n    initializeIndex: (indexName?: string) => Promise<{ numIndexed: number }>;\n    addLabel?: (exampleId: string, label: string) => Promise<boolean>;\n    getSignificantTermsForLabel: (\n      labelName: string\n    ) => Promise<{ terms: SignificantTerm[]; labelName: string }>;\n    saveToDisk?: () => void;\n  }\n}\n","export default function() {\n  return new Worker(__webpack_public_path__ + \"static/js/ndx_worker.bundle.worker.js\");\n}\n","export namespace GenericWorkerTypes {\n  export enum EWorkerName {\n    index = \"index\",\n    dataLoader = \"dataLoading\",\n    ai = \"ai\",\n  }\n\n  export enum ERquestOrResponesOrUpdate {\n    request = \"request\",\n    response = \"response\",\n    update = \"update\",\n  }\n\n  export interface GenericEvent {\n    workerName: EWorkerName;\n    direction: ERquestOrResponesOrUpdate;\n    payload: unknown;\n    requestId: number;\n    kind: unknown;\n  }\n\n  export interface RequestEvent extends GenericEvent {\n    direction: ERquestOrResponesOrUpdate.request;\n  }\n\n  export interface ResponseEvent extends GenericEvent {\n    direction: ERquestOrResponesOrUpdate.response;\n  }\n\n  export interface UpdateEvent extends GenericEvent {\n    direction: ERquestOrResponesOrUpdate.update;\n  }\n}\n","function logger(...message: any) {\n  if (process.env.NODE_ENV === \"development\") {\n    // eslint-disable-next-line no-console\n    console.log(message);\n  }\n}\n\nexport default logger;\n","import Worker from \"worker-loader!*\";\nimport { GenericWorkerTypes } from \"./datatypes\";\nimport logger from \"../../utils/logger\";\n\nabstract class WorkerSingletonBase {\n  protected static instance: WorkerSingletonBase;\n  initialized: boolean;\n  protected requestId: number;\n  protected responseListeners: Record<string, (evt: MessageEvent) => void>;\n  protected worker: Worker;\n  protected jobCount: number;\n\n  protected constructor(workerInstance: any) {\n    this.initialized = false;\n    this.requestId = 0;\n    this.responseListeners = {};\n    this.worker = workerInstance;\n    this.jobCount = 0;\n  }\n\n  protected nextRequestId() {\n    this.requestId++;\n    return this.requestId;\n  }\n  protected startWork<T extends GenericWorkerTypes.RequestEvent>(event: T) {\n    logger(\"Received requests\", event);\n    if (this.jobCount > 0) {\n      logger(\n        `Currently blocked with ${this.jobCount} jobs.  worker will queue`,\n        event\n      );\n    }\n    this.jobCount += 1;\n    this.worker.postMessage(event);\n  }\n  registerResponseHandler<T extends GenericWorkerTypes.ResponseEvent>(\n    requestId: number\n  ): Promise<T[\"payload\"]> {\n    return new Promise((resolve) => {\n      const responseHandler = (event: MessageEvent<T>) => {\n        if (event.data.kind && event.data.requestId === requestId) {\n          this.jobCount -= 1;\n          logger(`Finished request ${requestId}. ${this.jobCount} remaining`);\n          this.worker.removeEventListener(\n            \"message\",\n            this.responseListeners[requestId]\n          );\n          delete this.responseListeners[requestId];\n          resolve(event.data.payload);\n        } else {\n          logger(\"Unhandled response\", event.data);\n        }\n      };\n      this.responseListeners[requestId] = responseHandler;\n      this.worker.addEventListener(\"message\", responseHandler);\n    });\n  }\n}\n\nexport default WorkerSingletonBase;\n","import { NSIndexWorker } from \"./indexWorkerTypes\";\nimport Worker from \"worker-loader!./ndx_worker\";\nimport Data from \"../..//data_clients/datainterfaces\";\nimport { GenericWorkerTypes } from \"../common/datatypes\";\nimport WorkerSingletonBase from \"../..//workers/common/BaseWorker\";\nimport logger from \"../../utils/logger\";\n\nexport class IndexWorkerSingleton\n  extends WorkerSingletonBase\n  implements NSIndexWorker.IIndexSingelton {\n  private constructor() {\n    super(new Worker());\n  }\n\n  public static getInstance(): IndexWorkerSingleton {\n    if (IndexWorkerSingleton.instance === undefined) {\n      IndexWorkerSingleton.instance = new IndexWorkerSingleton();\n    }\n    return IndexWorkerSingleton.instance as IndexWorkerSingleton;\n  }\n\n  public initializeIndex(indexName?: string) {\n    const requestId = this.nextRequestId();\n    const message: NSIndexWorker.Request.IStartInit = {\n      workerName: GenericWorkerTypes.EWorkerName.index,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      requestId,\n      kind: NSIndexWorker.IndexRequestMessageKind.startInit,\n      payload: {\n        indexName,\n      },\n    };\n    this.worker.postMessage(message);\n    const me = this;\n    return this.registerResponseHandler<NSIndexWorker.Response.IEndInit>(\n      requestId\n    ).then((response) => {\n      me.initialized = true;\n      return response;\n    });\n  }\n\n  public buildIndex() {\n    const requestId = this.nextRequestId();\n    const event: NSIndexWorker.Request.IStartIndex = {\n      workerName: GenericWorkerTypes.EWorkerName.index,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      requestId,\n      kind: NSIndexWorker.IndexRequestMessageKind.startIndexing,\n      payload: {},\n    };\n\n    this.startWork(event);\n    return this.registerResponseHandler<NSIndexWorker.Response.IEndIndex>(\n      requestId\n    );\n  }\n\n  public addDocs(examples: Data.Example[]) {\n    if (!this.initialized) {\n      throw new Error(\"The index is not initialized yet\");\n    }\n    const requestId = this.nextRequestId();\n\n    const event: NSIndexWorker.Request.IStartDataInsert = {\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      requestId: requestId,\n      workerName: GenericWorkerTypes.EWorkerName.index,\n      kind: NSIndexWorker.IndexRequestMessageKind.startDataInsert,\n      payload: {\n        examples: examples,\n      },\n    };\n\n    this.startWork(event);\n    return this.registerResponseHandler<NSIndexWorker.Response.IEndDataInsert>(\n      requestId\n    );\n  }\n  public async insertAndIndex(examples: Data.Example[]) {\n    await this.addDocs(examples);\n    return this.buildIndex();\n  }\n  public getSignificantTermsForLabel(labelName: string) {\n    if (!this.initialized) {\n      logger(\"Index wasn't initialized\");\n      return Promise.reject();\n    }\n\n    const requestId = this.nextRequestId();\n    const message: NSIndexWorker.Request.IStartSignificantTerms = {\n      workerName: GenericWorkerTypes.EWorkerName.index,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n\n      kind: NSIndexWorker.IndexRequestMessageKind.startSignificantTerms,\n      requestId,\n      payload: {\n        labelName,\n      },\n    };\n\n    this.worker.postMessage(message);\n    return this.registerResponseHandler<NSIndexWorker.Response.IEndSignificantTerms>(\n      requestId\n    );\n  }\n\n  public query(query: string) {\n    if (!this.initialized) {\n      throw new Error(\"The index is not initialized yet\");\n    }\n    const requestId = this.nextRequestId();\n    const message: NSIndexWorker.Request.IStartQuery = {\n      workerName: GenericWorkerTypes.EWorkerName.index,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      kind: NSIndexWorker.IndexRequestMessageKind.startQuery,\n      requestId,\n      payload: {\n        query,\n      },\n    };\n    this.worker.postMessage(message);\n    return this.registerResponseHandler<NSIndexWorker.Response.IEndQuery>(\n      requestId\n    );\n  }\n}\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport TFIDFTransformer from \"../../../backend/workers/aiWorker/workerProcedures/vectorizers/tfidf\";\nimport Data from \"../../../backend/data_clients/datainterfaces\";\nimport { IndexWorkerSingleton } from \"../../../backend/workers/docIndex/IndexWorkerSingleton\";\n\nnamespace ExampleActions {\n  export interface ExampleState {\n    exampleIds: (string | number)[];\n    exampleIdsByDatasetName: Record<string, (string | number)[]>;\n    exampleTermFrequency: Record<string, Record<string, number>>;\n    docFrequency: Record<string, number>;\n  }\n\n  export interface AAddExampleByObject {\n    examples: Data.Example[];\n  }\n}\n\nfunction initialStateFactory(): ExampleActions.ExampleState {\n  return {\n    exampleIds: [],\n    exampleIdsByDatasetName: {},\n    exampleTermFrequency: {},\n    docFrequency: {},\n  };\n}\n\nconst exampleSlice = createSlice({\n  name: \"exampleSlice\",\n  initialState: initialStateFactory(),\n  reducers: {\n    addExamples(\n      state,\n      action: PayloadAction<ExampleActions.AAddExampleByObject>\n    ) {\n      const transformer = new TFIDFTransformer();\n      transformer.fitTransform(action.payload.examples);\n      action.payload.examples.forEach((example) => {\n        state.exampleIds.push(example.exampleId);\n        if (example.datasetName) {\n          const datasetSlice =\n            state.exampleIdsByDatasetName[example.datasetName];\n          if (datasetSlice) {\n            datasetSlice.push(example.exampleId);\n          } else {\n            state.exampleIdsByDatasetName[example.datasetName] = [\n              example.exampleId,\n            ];\n          }\n        }\n      });\n    },\n  },\n});\nexport async function addExamples(examples: Data.Example[]) {\n  const indexWorkerSingleton = IndexWorkerSingleton.getInstance();\n\n  await indexWorkerSingleton.insertAndIndex(examples);\n}\nconst exampleReducer = exampleSlice.reducer;\nexport default exampleReducer;\n","/*\n * Reducer to be used with useReducer not redux.\n * */\nimport { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\nnamespace SearchTypes {\n  type THas = 1 | -1;\n\n  export interface SearchParams {\n    //We make them null so that we can distinguish from undefined\n    hasLabel: THas | null;\n    hasPrediction: THas | null;\n    label: string | null;\n    predictedLabel: string | null;\n    // confidence: null | {\n    //   lt: number;\n    //   gt: number;\n    //   between: [number, number];\n    // };\n    searchQuery: null | string;\n    hasFilter: boolean;\n  }\n\n  export interface ASetSearchParams {\n    params: Partial<SearchParams>;\n  }\n}\n\nfunction initialStateFactory(): SearchTypes.SearchParams & {\n  everSearched: boolean;\n} {\n  return {\n    hasLabel: null,\n    hasPrediction: null,\n    label: null,\n    searchQuery: null,\n    predictedLabel: null,\n    hasFilter: false,\n    everSearched: false,\n  };\n}\n\nconst searchSlice = createSlice({\n  name: \"classificationSlice\",\n  initialState: initialStateFactory(),\n  reducers: {\n    setSearchParams(\n      state,\n      action: PayloadAction<SearchTypes.ASetSearchParams>\n    ) {\n      Object.entries(action.payload.params).forEach(([key, value]) => {\n        //@ts-ignore\n        state[key] = value;\n      });\n      if (action.payload.params.searchQuery) {\n        state.everSearched = true;\n      }\n      state.hasFilter =\n        state.hasLabel !== null ||\n        state.hasPrediction !== null ||\n        state.label !== null ||\n        state.predictedLabel !== null;\n    },\n  },\n});\nexport default searchSlice;\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\ntype TModes = \"Regular\" | \"ActiveLearning\";\nexport interface AppModeState {\n  mode: TModes;\n}\ninterface AChangeMode {\n  mode: TModes;\n}\n\nfunction initialStateFactory(): AppModeState {\n  return {\n    mode: \"Regular\",\n  };\n}\n\nconst appModeSlice = createSlice({\n  name: \"appMode\",\n  initialState: initialStateFactory(),\n  reducers: {\n    changeMode(state, action: PayloadAction<AChangeMode>) {\n      state.mode = action.payload.mode;\n    },\n  },\n});\n\nexport default appModeSlice;\n","import { TypedUseSelectorHook, useSelector } from \"react-redux\";\nimport { enableAllPlugins, enableMapSet } from \"immer\";\nimport {\n  Action,\n  combineReducers,\n  configureStore,\n  getDefaultMiddleware,\n  ThunkAction,\n} from \"@reduxjs/toolkit\";\nimport {\n  FLUSH,\n  PAUSE,\n  PERSIST,\n  persistReducer,\n  persistStore,\n  PURGE,\n  REGISTER,\n  REHYDRATE,\n} from \"redux-persist\";\n\nimport storage from \"redux-persist/lib/storage\"; // defaults to localStorage for web\nimport classificationReducer from \"./classification/classificationReducer\";\nimport exampleReducer from \"./examples/exampleState\";\nimport searchSlice from \"../QueryContext/searchReducer\";\nimport appModeSlice from \"./modes/modeReducer\";\n\nexport const res = enableMapSet();\n\nenableAllPlugins();\nconst rootReducer = combineReducers({\n  classificationReducer,\n  exampleReducer,\n  searchReducer: searchSlice.reducer,\n  appMode: appModeSlice.reducer,\n});\nconst persistConfig = {\n  key: \"root\",\n  storage,\n};\n\nconst persistedReducer = persistReducer(persistConfig, rootReducer);\n\nconst store = configureStore({\n  reducer: persistedReducer,\n  middleware: getDefaultMiddleware({\n    serializableCheck: {\n      ignoredActions: [FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER],\n    },\n  }),\n});\npersistStore(store);\n\nexport type RootState = ReturnType<typeof rootReducer>;\nexport type AppThunk = ThunkAction<void, RootState, unknown, Action<string>>;\n\nexport const useTypedSelector: TypedUseSelectorHook<RootState> = useSelector;\nexport default store;\n","import Dexie from \"dexie\";\nimport \"dexie-observable\";\nimport Data, { AnalyticsData } from \"../data_clients/datainterfaces\";\nimport { IDatabaseChange, IUpdateChange } from \"dexie-observable/api\";\n\nexport type TDBChangeCallback = (changeEvent: IDatabaseChange) => void;\nexport type TableNames =\n  | \"example\"\n  | \"label\"\n  | \"indexCache\"\n  | \"vector\"\n  | \"tfidf\"\n  | \"kfold\";\n\nexport class OurDatabase extends Dexie {\n  example: Dexie.Table<Data.Example, string>;\n  label: Dexie.Table<Data.Label, string>;\n  indexCache: Dexie.Table<Data.SerializedIndex, string>; // stores the search index\n  vector: Dexie.Table<Data.Vector, string>;\n  tfidf: Dexie.Table<Data.TFIDF, string>;\n\n  kfold: Dexie.Table<\n    AnalyticsData.PrecisionRecallKfoldMetric,\n    [Date, number, string]\n  >;\n  changeCallbacks: Record<TableNames, TDBChangeCallback[]>;\n\n  public addTableEventListener(\n    tableName: TableNames,\n    callback: TDBChangeCallback\n  ) {\n    this.changeCallbacks[tableName].push(callback);\n  }\n\n  public removeTableEventListener(\n    tableName: TableNames,\n    callback: TDBChangeCallback\n  ) {\n    this.changeCallbacks[tableName] = this.changeCallbacks[tableName].filter(\n      (x) => x !== callback\n    );\n  }\n\n  constructor() {\n    super(\"OurDatabase\");\n    this.version(8).stores({\n      example:\n        \"exampleId,datasetName,label,hasLabel,hasPrediction,[hasPrediction+hasLabel],predictedLabel,[predictedLabel+label],[predictedLabel+hasLabel],confidence,hasNegativeOrRejectedLabel\",\n      label: \"name\",\n      indexCache: \"name\",\n      vector: \"exampleId,label,hasLabel,hasNegativeOrRejectedLabel\",\n      tfidf: \"exampleId,label,hasLabel,hasNegativeOrRejectedLabel\",\n      kfold: \"[timestamp+kNumber+label],[timestamp+label]\",\n    });\n    this.example = this.table(\"example\");\n    this.label = this.table(\"label\");\n    this.indexCache = this.table(\"indexCache\");\n    this.vector = this.table(\"vector\");\n    this.tfidf = this.table(\"tfidf\");\n    this.kfold = this.table(\"kfold\");\n    this.changeCallbacks = {\n      example: [],\n      label: [],\n      indexCache: [],\n      vector: [],\n      tfidf: [],\n      kfold: [],\n    };\n  }\n}\n\nfunction gatherLabelChangeCount(\n  change: IDatabaseChange,\n  labelChangeAccumulator: Record<string, number>\n) {\n  if (\n    change.table === \"example\" &&\n    change.type === 2 //DatabaseChangeType.Update\n  ) {\n    change = change as IUpdateChange;\n    const oldLabel = (change.oldObj as Data.Example).label;\n    const newLabel = (change.obj as Data.Example).label;\n    if (newLabel === oldLabel) {\n      //do nothing\n    } else {\n      if (oldLabel !== undefined) {\n        labelChangeAccumulator[oldLabel] =\n          labelChangeAccumulator[oldLabel] - 1 || -1;\n      }\n      if (newLabel !== undefined) {\n        labelChangeAccumulator[newLabel] =\n          labelChangeAccumulator[newLabel] + 1 || +1;\n      }\n    }\n  }\n}\n\nasync function updateLabelCount(labelName: string, difference: number) {\n  const label = await mainThreadDB.label\n    .where(\"name\")\n    .equals(labelName)\n    .first();\n  if (label) {\n    const newCount = label.count + difference;\n    return mainThreadDB.label.update(labelName, { count: newCount });\n  } else {\n    return Promise.reject(`Couldn't find label \n    ${labelName} in db`);\n  }\n}\n\nfunction initatiateMainThreadDB() {\n  const mainThreadDB = new OurDatabase();\n  mainThreadDB.on(\"changes\", (changes) => {\n    const labelChangeAccumulator: Record<string, number> = {};\n    changes.forEach((change) => {\n      gatherLabelChangeCount(change, labelChangeAccumulator);\n\n      const callbacks =\n        mainThreadDB.changeCallbacks[change.table as TableNames];\n      callbacks.forEach((callback) => callback(change));\n    });\n    Promise.all(\n      Object.entries(labelChangeAccumulator).map(([name, dif]) =>\n        updateLabelCount(name, dif)\n      )\n    );\n    if (Object.keys(labelChangeAccumulator).length) {\n    }\n  });\n  return mainThreadDB;\n}\n\nconst mainThreadDB = initatiateMainThreadDB();\n\nconst initiateWorkerDB = () => {\n  const workerDB = new OurDatabase();\n  return workerDB;\n};\nconst workerDB = initiateWorkerDB();\n\nexport { mainThreadDB, workerDB };\n","import React from \"react\";\nimport { useTypedSelector } from \"../redux-state/rootState\";\nimport { IndexWorkerSingleton } from \"../../backend/workers/docIndex/IndexWorkerSingleton\";\nimport { mainThreadDB } from \"../../backend/database/database\";\nimport intersection from \"lodash/intersection\";\nimport { useQuery } from \"react-query\";\nimport logger from \"../../backend/utils/logger\";\n\nconst indexWorkerSingleton = IndexWorkerSingleton.getInstance();\nfunction useSearchQuery() {\n  const searchParams = useTypedSelector((state) => state.searchReducer);\n\n  const searchFunction = React.useCallback(async () => {\n    logger(\"Calling search\", searchParams);\n    const criteria = {\n      hasLabel: searchParams.hasLabel || undefined,\n      hasPrediction: searchParams.hasPrediction || undefined,\n      label: searchParams.label || undefined,\n      predictedLabel: searchParams.predictedLabel || undefined,\n    };\n    Object.keys(criteria).forEach(\n      //@ts-ignore\n      (key) => criteria[key] === undefined && delete criteria[key]\n    );\n\n    const filterFunction = () => {\n      return (!searchParams.hasFilter\n        ? mainThreadDB.example.toCollection()\n        : mainThreadDB.example.where(criteria)\n      )\n\n        .primaryKeys()\n        .then((keys) => {\n          logger(`Got back ${keys.length} from filter`);\n          logger(\"Filter was\", searchParams);\n          return keys;\n        });\n    };\n    if (\n      searchParams.searchQuery !== null &&\n      searchParams.searchQuery.length > 0\n    ) {\n      const searchQuery = searchParams.searchQuery;\n      return filterFunction().then(async (filterResult) => {\n        const searchResults = await indexWorkerSingleton.query(searchQuery);\n        logger(\n          `Search for \"${searchQuery}\" and got ${searchResults.results.length} results`\n        );\n        return intersection(\n          searchResults.results.map((x) => x.exampleId),\n          filterResult\n        );\n      });\n    } else {\n      return filterFunction();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParams]);\n\n  return useQuery([\"search\", searchParams], searchFunction);\n}\n\nexport default useSearchQuery;\n","import React, { FunctionComponent } from \"react\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\n\nconst useStyles = makeStyles((theme) => ({\n  \"@keyframes active\": {\n    \"0%\": {\n      webkitTransform: \"scale(.1)\",\n      opacity: \"1\",\n      transform: \"scale(.1)\",\n    },\n    \"70%\": {\n      webkitTransform: \"scale(2.5)\",\n      opacity: \"0\",\n      transform: \"scale(2.5)\",\n    },\n    \"100%\": {\n      opacity: \"0\",\n    },\n  },\n  beaconContainer: {\n    position: \"relative\",\n  },\n\n  beacon: {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    backgroundColor: theme.palette.secondary.light,\n    height: theme.spacing(1),\n    width: theme.spacing(1),\n    borderRadius: \"50%\",\n    webkitTransform: \"translateX(-50%) translateY(-50%)\",\n    \"&:before\": {\n      position: \"absolute\",\n      content: '\"\"',\n      height: theme.spacing(1),\n      width: theme.spacing(1),\n      left: \"0\",\n      top: \"0\",\n      backgroundColor: \"transparent\",\n      borderRadius: \"50%\",\n      boxShadow: `0px 0px 2px 2px ${theme.palette.secondary.main}`,\n      animationName: \"$active\",\n      animationDuration: \"2s\",\n      animationTimingFunction: \"linear\",\n      animationIterationCount: \"infinite\",\n    },\n  },\n}));\n\nexport const Beacon: FunctionComponent<{ show: boolean }> = ({ show }) => {\n  const classes = useStyles();\n  if (!show) {\n    return null;\n  }\n  return (\n    <span className={classes.beaconContainer}>\n      <span className={classes.beacon} />\n    </span>\n  );\n};\n\nexport default Beacon;\n","import React, { FunctionComponent } from \"react\";\nimport debounce from \"@material-ui/core/utils/debounce\";\nimport searchSlice from \"../../QueryContext/searchReducer\";\nimport { useTypedSelector } from \"../../redux-state/rootState\";\nimport useSearchQuery from \"../../QueryContext/useSearchQuery\";\nimport { useDispatch } from \"react-redux\";\nimport { LinearProgress } from \"@material-ui/core\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport InputBase from \"@material-ui/core/InputBase\";\nimport { fade } from \"@material-ui/core/styles\";\nimport Fade from \"@material-ui/core/Fade\";\nimport Beacon from \"../Beacon\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\n\nconst useStyles = makeStyles((theme) => ({\n  inputRoot: {\n    color: \"inherit\",\n  },\n  inputInput: {\n    padding: theme.spacing(1, 1, 1, 0),\n    // vertical padding + font size from searchIcon\n    paddingLeft: `calc(1em + ${theme.spacing(4)}px)`,\n    transition: theme.transitions.create(\"width\"),\n    width: \"100%\",\n    [theme.breakpoints.up(\"md\")]: {\n      width: \"20ch\",\n    },\n  },\n  resultCount: {\n    margin: theme.spacing(0, 1),\n    fontWeight: \"bold\",\n  },\n  search: {\n    position: \"relative\",\n    borderRadius: theme.shape.borderRadius,\n    backgroundColor: fade(theme.palette.common.white, 0.15),\n    \"&:hover\": {\n      backgroundColor: fade(theme.palette.common.white, 0.25),\n    },\n    marginRight: theme.spacing(2),\n    marginLeft: 0,\n    width: \"100%\",\n    [theme.breakpoints.up(\"sm\")]: {\n      marginLeft: theme.spacing(3),\n      width: \"auto\",\n    },\n  },\n  searchIcon: {\n    padding: theme.spacing(0, 2),\n    height: \"100%\",\n    position: \"absolute\",\n    pointerEvents: \"none\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n}));\nconst SearchBar: FunctionComponent = () => {\n  const classes = useStyles();\n\n  const { searchQuery, everSearched } = useTypedSelector(\n    (state) => state.searchReducer\n  );\n  const [value, setValue] = React.useState<string | undefined>(\n    searchQuery || undefined\n  );\n  const exampleIds = useSearchQuery();\n  const dispatch = useDispatch();\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const debouncedUpdate = React.useCallback(\n    debounce((e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) => {\n      dispatch(\n        searchSlice.actions.setSearchParams({\n          params: { searchQuery: e.target.value },\n        })\n      );\n    }, 250),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    []\n  );\n  const handleChange = (\n    e: React.ChangeEvent<HTMLTextAreaElement | HTMLInputElement>\n  ) => {\n    setValue(e.target.value);\n    debouncedUpdate(e);\n  };\n\n  React.useEffect(() => {\n    if (searchQuery) {\n      setValue(searchQuery);\n    }\n  }, [searchQuery]);\n\n  return (\n    <div className={classes.search}>\n      <div className={classes.searchIcon}>\n        <SearchIcon />\n      </div>\n\n      <InputBase\n        placeholder=\"Search…\"\n        value={value}\n        onChange={handleChange}\n        classes={{\n          root: classes.inputRoot,\n          input: classes.inputInput,\n        }}\n        inputProps={{ \"aria-label\": \"search\" }}\n        endAdornment={\n          <InputAdornment position={\"end\"}>\n            <span className={classes.resultCount}>\n              {\" \"}\n              {exampleIds.data?.length}\n            </span>\n          </InputAdornment>\n        }\n      />\n      <Fade in={exampleIds.isLoading}>\n        <LinearProgress />\n      </Fade>\n      <Beacon show={!everSearched} />\n    </div>\n    // <FilterCheckboxes />\n  );\n};\nexport default SearchBar;\n","import React, { FunctionComponent } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { FormGroup } from \"@material-ui/core\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport Checkbox from \"@material-ui/core/Checkbox\";\nimport { useTypedSelector } from \"../../redux-state/rootState\";\nimport searchSlice from \"../../QueryContext/searchReducer\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\n\nconst useStyles = makeStyles({\n  root: {},\n  icon: {\n    borderRadius: 3,\n    width: 16,\n    height: 16,\n  },\n  checkedIcon: {},\n});\n\nconst FilterCheckboxes: FunctionComponent = (props) => {\n  const dispatch = useDispatch();\n  const classes = useStyles();\n  const state = useTypedSelector((state) => state.searchReducer);\n  return (\n    <FormGroup row style={{ display: \"inline\" }}>\n      <FormControlLabel\n        labelPlacement={\"bottom\"}\n        control={\n          <Checkbox\n            checked={state.hasLabel === 1}\n            onChange={(e, v) =>\n              dispatch(\n                searchSlice.actions.setSearchParams({\n                  params: { hasLabel: v ? 1 : null },\n                })\n              )\n            }\n            value={state.hasLabel === 1}\n          />\n        }\n        label={<span style={{ fontSize: \"0.75rem\" }}>Show Labeled</span>}\n      />\n      <FormControlLabel\n        classes={classes}\n        labelPlacement={\"bottom\"}\n        control={\n          <Checkbox\n            size={\"small\"}\n            style={{ fontSize: \"0.5rem\" }}\n            checked={state.hasLabel === -1}\n            onChange={(e, v) =>\n              dispatch(\n                searchSlice.actions.setSearchParams({\n                  params: { hasLabel: v ? -1 : null },\n                })\n              )\n            }\n            value={state.hasLabel === -1}\n          />\n        }\n        label={<span style={{ fontSize: \"0.75rem\" }}>Hide Labeled</span>}\n      />\n\n      <FormControlLabel\n        labelPlacement={\"bottom\"}\n        control={\n          <Checkbox\n            checked={state.hasPrediction === 1}\n            onChange={(e, v) =>\n              dispatch(\n                searchSlice.actions.setSearchParams({\n                  params: { hasPrediction: v ? 1 : null },\n                })\n              )\n            }\n            value={state.hasPrediction === 1}\n          />\n        }\n        label={<span style={{ fontSize: \"0.75rem\" }}>Show Predicted</span>}\n      />\n      <FormControlLabel\n        labelPlacement={\"bottom\"}\n        control={\n          <Checkbox\n            checked={state.hasPrediction === -1}\n            onChange={(e, v) =>\n              dispatch(\n                searchSlice.actions.setSearchParams({\n                  params: { hasPrediction: v ? -1 : null },\n                })\n              )\n            }\n            value={state.hasPrediction === -1}\n          />\n        }\n        label={<span style={{ fontSize: \"0.75rem\" }}>Hide Predicted</span>}\n      />\n    </FormGroup>\n  );\n};\n\nexport default FilterCheckboxes;\n","import React from \"react\";\nimport {\n  mainThreadDB,\n  OurDatabase,\n  TableNames,\n  TDBChangeCallback,\n} from \"./database\";\nimport { QueryKey, useQuery } from \"react-query\";\n\nfunction useDatabase<T>(\n  queryKey: QueryKey,\n  table: TableNames,\n  dbQuery: (db: OurDatabase) => Promise<T>,\n  changeKey: string | undefined\n) {\n  const query = useQuery(queryKey, () => dbQuery(mainThreadDB));\n  React.useEffect(() => {\n    const resetQueryCallback: TDBChangeCallback = (change) => {\n      if (change.table === table) {\n        if (changeKey === undefined || changeKey === change.key) {\n          query.refetch();\n        }\n      }\n    };\n    mainThreadDB.addTableEventListener(table, resetQueryCallback);\n    return () => {\n      mainThreadDB.removeTableEventListener(table, resetQueryCallback);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return query;\n}\nexport function useExampleCount() {\n  const exampleCountQuery = useDatabase(\n    \"exampleCount\",\n    \"example\",\n    (db) => db.example.count(),\n    undefined\n  );\n  return exampleCountQuery;\n}\nexport function useLabelCount() {\n  const exampleCountQuery = useDatabase(\n    \"labelCount\",\n    \"label\",\n    (db) => db.label.count(),\n    undefined\n  );\n  return exampleCountQuery;\n}\n\nexport function usePredictionCount() {\n  const exampleCountQuery = useDatabase(\n    \"predictionCount\",\n    \"example\",\n    (db) => db.example.where({ hasPrediction: 1 }).count(),\n    undefined\n  );\n  return exampleCountQuery;\n}\nexport default useDatabase;\n","import React, { FunctionComponent } from \"react\";\nimport { useTypedSelector } from \"../../redux-state/rootState\";\nimport { useDispatch } from \"react-redux\";\nimport appModeSlice from \"../../redux-state/modes/modeReducer\";\nimport Switch from \"@material-ui/core/Switch\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\nimport { usePredictionCount } from \"../../../backend/database/useDatabase\";\n\nconst ActiveLearningToggleContainer: FunctionComponent = () => {\n  const mode = useTypedSelector((state) => state.appMode.mode);\n  const predictionCountQuery = usePredictionCount();\n  const dispatch = useDispatch();\n  const handleChange = () => {\n    const nextMode = mode === \"Regular\" ? \"ActiveLearning\" : \"Regular\";\n    dispatch(appModeSlice.actions.changeMode({ mode: nextMode }));\n  };\n  if (!predictionCountQuery.data) {\n    return null;\n  }\n  return (\n    <FormControlLabel\n      labelPlacement={\"bottom\"}\n      control={\n        <Switch value={mode === \"ActiveLearning\"} onChange={handleChange} />\n      }\n      label={\"Active Learning\"}\n    />\n  );\n};\n\nexport default ActiveLearningToggleContainer;\n","import fileDownload from \"js-file-download\";\nimport { mainThreadDB } from \"../../../backend/database/database\";\nimport * as Papa from \"papaparse\";\nimport React, { FunctionComponent } from \"react\";\nimport { useMutation } from \"react-query\";\nimport { Button } from \"@material-ui/core\";\nimport { useExampleCount } from \"../../../backend/database/useDatabase\";\n\nasync function downloadResults() {\n  const examples = await mainThreadDB.example\n    .orderBy([\"hasPrediction\", \"hasLabel\"])\n    .reverse()\n    .toArray();\n  const example = examples[0];\n  const metaDataKeys = Object.keys(example.metadata || {});\n  const columns = [\n    \"exampleId\",\n    \"content\",\n    \"label\",\n    \"predictedLabel\",\n    \"confidence\",\n    ...metaDataKeys,\n  ];\n  const formatedExamples = examples.map((ex) => ({\n    ...ex,\n    ...(ex.metadata || {}),\n  }));\n  const csv = Papa.unparse({ fields: columns, data: formatedExamples });\n  fileDownload(csv, \"ylabalResults.csv\", \"text/csv\");\n}\n\nconst DownloadButton: FunctionComponent = () => {\n  const [downloadFunc, downloadStatus] = useMutation(downloadResults);\n  const exampleCountQuery = useExampleCount();\n  if (!exampleCountQuery.data) {\n    return null;\n  }\n  return (\n    <Button\n      variant=\"contained\"\n      color={\"primary\"}\n      onClick={() => downloadFunc()}\n      disabled={downloadStatus.isLoading}\n    >\n      Download\n    </Button>\n  );\n};\n\nexport default DownloadButton;\n","import React, { FunctionComponent } from \"react\";\nimport { Dialog } from \"@material-ui/core\";\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\nimport Typography from \"@material-ui/core/Typography\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DownloadButton from \"./DownloadButton\";\nimport Button from \"@material-ui/core/Button\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\nimport { mainThreadDB } from \"../../../backend/database/database\";\nimport { useExampleCount } from \"../../../backend/database/useDatabase\";\n\nconst useStyles = makeStyles((theme) => ({\n  header: {\n    background: theme.palette.error.main,\n    color: theme.palette.error.contrastText,\n  },\n  button: {\n    background: theme.palette.error.main,\n    color: theme.palette.error.contrastText,\n    \"&:hover\": {\n      backgroundColor: theme.palette.error.dark,\n    },\n  },\n}));\nasync function handleDelete() {\n  await mainThreadDB.delete();\n  localStorage.removeItem(\"persist:root\");\n  window.location.reload();\n}\nexport const DeleteAllButton: FunctionComponent = () => {\n  const [open, setOpen] = React.useState<boolean>(false);\n  const classes = useStyles();\n  const exampleCountQuery = useExampleCount();\n  if (!exampleCountQuery.data) {\n    return null;\n  }\n  return (\n    <>\n      <Button onClick={() => setOpen(true)} className={classes.button}>\n        Start Over\n      </Button>\n      <Dialog color={\"danger\"} open={open} onClose={() => setOpen(false)}>\n        <DialogTitle className={classes.header}>\n          <Typography variant={\"h3\"}>Delete All Data ?</Typography>\n        </DialogTitle>\n        <DialogContent>\n          <Typography variant={\"h4\"} gutterBottom={true}>\n            Your about to delete all of the work you've done.\n          </Typography>\n          <Typography variant={\"h4\"} gutterBottom={true}>\n            Are you sure you want to ?\n          </Typography>\n        </DialogContent>\n        <DialogActions>\n          <DownloadButton />\n          <Button\n            variant={\"outlined\"}\n            onClick={handleDelete}\n            className={classes.button}\n          >\n            Yes I'm Sure\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\nexport default DeleteAllButton;\n","import React from \"react\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\n\nconst useStyles = makeStyles(() => ({\n  \"@global\": {\n    \".github-corner:hover .octo-arm\": {\n      animation: \"octocat-wave 560ms ease-in-out\",\n    },\n    \"@keyframes octocat-wave\": {\n      \"0%, 100%\": {\n        transform: \"rotate(0)\",\n      },\n      \"20%, 60%\": {\n        transform: \"rotate(-25deg)\",\n      },\n      \"40%, 80%\": {\n        transform: \"rotate(10deg)\",\n      },\n    },\n    \"@media (max-width: 500px)\": {\n      \".github-corner:hover .octo-arm\": {\n        animation: \"none\",\n      },\n      \".github-corner .octo-arm\": {\n        animation: \"octocat-wave 560ms ease-in-out\",\n      },\n    },\n  },\n}));\n\nconst ForkOnGithub = () => {\n  useStyles();\n  return (\n    <a\n      href=\"https://github.com/LightTag/ylabel2\"\n      className=\"github-corner\"\n      aria-label=\"View source on GitHub\"\n      /* eslint-disable-next-line react/jsx-no-target-blank */\n      target={\"_blank\"}\n    >\n      <svg\n        width=\"80\"\n        height=\"80\"\n        viewBox=\"0 0 250 250\"\n        style={{\n          fill: \"#151513\",\n          color: \"#fff\",\n          position: \"absolute\",\n          top: 0,\n          border: 0,\n          right: 0,\n        }}\n        aria-hidden=\"true\"\n      >\n        <path d=\"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z\"></path>\n        <path\n          d=\"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2\"\n          fill=\"currentColor\"\n          style={{ transformOrigin: \"130px 106px\" }}\n          className=\"octo-arm\"\n        ></path>\n        <path\n          d=\"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z\"\n          fill=\"currentColor\"\n          className=\"octo-body\"\n        ></path>\n      </svg>\n    </a>\n  );\n};\n\nexport default ForkOnGithub;\n","import React from \"react\";\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\";\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Badge from \"@material-ui/core/Badge\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuIcon from \"@material-ui/icons/Menu\";\nimport AccountCircle from \"@material-ui/icons/AccountCircle\";\nimport MailIcon from \"@material-ui/icons/Mail\";\nimport NotificationsIcon from \"@material-ui/icons/Notifications\";\nimport MoreIcon from \"@material-ui/icons/MoreVert\";\nimport SearchBar from \"../searchBar/SearchBar\";\nimport FilterCheckboxes from \"../searchBar/FilterCheckboxes\";\nimport ActiveLearningToggleContainer from \"./ActiveLearningToggleContainer\";\nimport { useTypedSelector } from \"../../redux-state/rootState\";\nimport { Fade } from \"@material-ui/core\";\nimport Slide from \"@material-ui/core/Slide\";\nimport DownloadButton from \"./DownloadButton\";\nimport DeleteAllButton from \"./DeleteAllButton\";\nimport ForkOnGithub from \"./ForkOnGithub\";\nimport { useExampleCount } from \"../../../backend/database/useDatabase\";\n\nexport const AppBarHeight = \"64px\";\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    grow: {\n      flexGrow: 1,\n    },\n    regularModeControls: {\n      position: \"relative\",\n      borderRadius: theme.shape.borderRadius,\n\n      marginRight: theme.spacing(2),\n      marginLeft: 0,\n      width: \"100%\",\n      [theme.breakpoints.up(\"sm\")]: {\n        marginLeft: theme.spacing(3),\n        width: \"auto\",\n      },\n    },\n    menuButton: {\n      marginRight: theme.spacing(2),\n    },\n    title: {\n      display: \"none\",\n      [theme.breakpoints.up(\"sm\")]: {\n        display: \"block\",\n      },\n    },\n    sectionDesktop: {\n      display: \"none\",\n      [theme.breakpoints.up(\"md\")]: {\n        display: \"flex\",\n        marginRight: theme.spacing(6),\n      },\n    },\n    sectionMobile: {\n      display: \"flex\",\n      [theme.breakpoints.up(\"md\")]: {\n        display: \"none\",\n      },\n    },\n  })\n);\n\nexport default function PrimarySearchAppBar() {\n  const classes = useStyles();\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n  const [\n    mobileMoreAnchorEl,\n    setMobileMoreAnchorEl,\n  ] = React.useState<null | HTMLElement>(null);\n\n  const isMenuOpen = Boolean(anchorEl);\n  const isMobileMenuOpen = Boolean(mobileMoreAnchorEl);\n  const mode = useTypedSelector((state) => state.appMode.mode);\n  const isActiveLearning = mode === \"ActiveLearning\";\n  const exampleCountQuery = useExampleCount();\n  if (!exampleCountQuery.data) {\n    return null;\n  }\n  const hasExamples = exampleCountQuery.data > 0;\n\n  const handleProfileMenuOpen = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleMobileMenuClose = () => {\n    setMobileMoreAnchorEl(null);\n  };\n\n  const handleMenuClose = () => {\n    setAnchorEl(null);\n    handleMobileMenuClose();\n  };\n\n  const handleMobileMenuOpen = (event: React.MouseEvent<HTMLElement>) => {\n    setMobileMoreAnchorEl(event.currentTarget);\n  };\n\n  const menuId = \"primary-search-account-menu\";\n  const renderMenu = (\n    <Menu\n      anchorEl={anchorEl}\n      anchorOrigin={{ vertical: \"top\", horizontal: \"right\" }}\n      id={menuId}\n      keepMounted\n      transformOrigin={{ vertical: \"top\", horizontal: \"right\" }}\n      open={isMenuOpen}\n      onClose={handleMenuClose}\n    >\n      <MenuItem onClick={handleMenuClose}>Profile</MenuItem>\n      <MenuItem onClick={handleMenuClose}>My account</MenuItem>\n    </Menu>\n  );\n\n  const mobileMenuId = \"primary-search-account-menu-mobile\";\n  const renderMobileMenu = (\n    <Menu\n      anchorEl={mobileMoreAnchorEl}\n      anchorOrigin={{ vertical: \"top\", horizontal: \"right\" }}\n      id={mobileMenuId}\n      keepMounted\n      transformOrigin={{ vertical: \"top\", horizontal: \"right\" }}\n      open={isMobileMenuOpen}\n      onClose={handleMobileMenuClose}\n    >\n      <MenuItem>\n        <IconButton aria-label=\"show 4 new mails\" color=\"inherit\">\n          <Badge badgeContent={4} color=\"secondary\">\n            <MailIcon />\n          </Badge>\n        </IconButton>\n        <p>Messages</p>\n      </MenuItem>\n      <MenuItem>\n        <IconButton aria-label=\"show 11 new notifications\" color=\"inherit\">\n          <Badge badgeContent={11} color=\"secondary\">\n            <NotificationsIcon />\n          </Badge>\n        </IconButton>\n        <p>Notifications</p>\n      </MenuItem>\n      <MenuItem onClick={handleProfileMenuOpen}>\n        <IconButton\n          aria-label=\"account of current user\"\n          aria-controls=\"primary-search-account-menu\"\n          aria-haspopup=\"true\"\n          color=\"inherit\"\n        >\n          <AccountCircle />\n        </IconButton>\n        <p>Profile</p>\n      </MenuItem>\n    </Menu>\n  );\n\n  return (\n    <div className={classes.grow}>\n      <AppBar position=\"static\">\n        <Toolbar>\n          <IconButton\n            edge=\"start\"\n            className={classes.menuButton}\n            color=\"inherit\"\n            aria-label=\"open drawer\"\n          >\n            <MenuIcon />\n          </IconButton>\n          <Typography className={classes.title} variant=\"h6\" noWrap>\n            YLabel\n          </Typography>\n\n          <ActiveLearningToggleContainer />\n          <Fade in={!isActiveLearning && hasExamples}>\n            <span className={classes.regularModeControls}>\n              <SearchBar />\n            </span>\n          </Fade>\n          <Slide in={!isActiveLearning && hasExamples}>\n            <span className={classes.regularModeControls}>\n              <FilterCheckboxes />\n            </span>\n          </Slide>\n          <div className={classes.grow} />\n\n          <div className={classes.sectionDesktop}>\n            <DeleteAllButton />\n            <DownloadButton />\n          </div>\n          <div className={classes.sectionMobile}>\n            <IconButton\n              aria-label=\"show more\"\n              aria-controls={mobileMenuId}\n              aria-haspopup=\"true\"\n              onClick={handleMobileMenuOpen}\n              color=\"inherit\"\n            >\n              <MoreIcon />\n            </IconButton>\n          </div>\n        </Toolbar>\n        <ForkOnGithub />\n      </AppBar>\n      {renderMobileMenu}\n      {renderMenu}\n    </div>\n  );\n}\n","import React from \"react\";\nimport { ReflexContainer, ReflexElement, ReflexSplitter } from \"react-reflex\";\nimport { AppBarHeight } from \"../../appBar/Appbar\";\nimport { useTheme } from \"@material-ui/core\";\n\ninterface Props {\n  Left: JSX.Element;\n  Middle: JSX.Element;\n  Right: JSX.Element;\n}\nconst ThreeColumnBody: React.FunctionComponent<Props> = (props) => {\n  const theme = useTheme();\n  return (\n    <ReflexContainer\n      orientation=\"vertical\"\n      style={{\n        height: `calc(100vh - ${AppBarHeight})`,\n        padding: theme.spacing(2),\n      }}\n    >\n      <ReflexElement propagateDimensions flex={0.25}>\n        <div\n          style={{\n            height: \"100%\",\n            maxHeight: \"100%\",\n            overflowY: \"hidden\",\n          }}\n        >\n          {props.Left}\n        </div>\n      </ReflexElement>\n      <ReflexSplitter />\n      <ReflexElement propagateDimensions flex={0.5}>\n        <div\n          style={{\n            height: \"100%\",\n            width: \"100%\",\n            maxWidth: \"100%\",\n            maxHeight: \"100%\",\n            overflowY: \"auto\",\n          }}\n        >\n          {props.Middle}\n        </div>\n      </ReflexElement>\n      <ReflexSplitter />\n      <ReflexElement propagateDimensions flex={0.25}>\n        <div\n          style={{\n            height: \"100%\",\n            maxHeight: \"100%\",\n            overflowY: \"hidden\",\n          }}\n        >\n          <div style={{ padding: \"2rem\" }}>{props.Right}</div>\n        </div>\n      </ReflexElement>\n    </ReflexContainer>\n  );\n};\nexport default ThreeColumnBody;\n","class LabselsetColorsManager {\n  colormap: Record<string, string>;\n  size: number;\n  labels: Set<string>;\n\n  constructor() {\n    this.colormap = {};\n    this.size = 0;\n    this.labels = new Set();\n  }\n\n  addLabel(label: string) {\n    if (this.labels.has(label)) {\n    } else {\n      this.labels.add(label);\n      this.recolor();\n    }\n  }\n\n  getLabelColor(label: string) {\n    this.addLabel(label);\n    return this.colormap[label];\n  }\n\n  private recolor() {\n    const s = 0.32;\n    const l = 0.6;\n    let h = 0;\n    const num = this.labels.size;\n    const step = 359 / num;\n    this.colormap = {};\n    this.labels.forEach((label) => {\n      this.colormap[label] = HSLToHex(h, s, l);\n      h += step;\n    });\n  }\n}\n\nfunction HSLToHex(H: number, S: number, L: number): string {\n  const rgb = HSL2RGB(H, S, L);\n  return RGB2HEX(rgb);\n}\n\n/**\n * Convert RGB Array to HEX\n *\n * @param {Array} RGBArray - [R, G, B]\n * @returns {String} 6 digits hex starting with #\n */\nvar RGB2HEX = function (RGBArray: Array<number>): string {\n  var hex = \"#\";\n  RGBArray.forEach(function (value) {\n    if (value < 16) {\n      hex += 0;\n    }\n    hex += value.toString(16);\n  });\n  return hex;\n};\n\n/**\n * Convert HSL to RGB\n *\n * @see {@link http://zh.wikipedia.org/wiki/HSL和HSV色彩空间} for further information.\n * @param {Number} H Hue ∈ [0, 360)\n * @param {Number} S Saturation ∈ [0, 1]\n * @param {Number} L Lightness ∈ [0, 1]\n * @returns {Array} R, G, B ∈ [0, 255]\n */\nvar HSL2RGB = function (H: number, S: number, L: number): Array<number> {\n  H /= 360;\n\n  var q = L < 0.5 ? L * (1 + S) : L + S - L * S;\n  var p = 2 * L - q;\n\n  return [H + 1 / 3, H, H - 1 / 3].map(function (color) {\n    if (color < 0) {\n      color++;\n    }\n    if (color > 1) {\n      color--;\n    }\n    if (color < 1 / 6) {\n      color = p + (q - p) * 6 * color;\n    } else if (color < 0.5) {\n      color = q;\n    } else if (color < 2 / 3) {\n      color = p + (q - p) * 6 * (2 / 3 - color);\n    } else {\n      color = p;\n    }\n    return Math.round(color * 255);\n  });\n};\nconst colorManaer = new LabselsetColorsManager();\nexport default colorManaer;\n","import React, { FunctionComponent } from \"react\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    marginLeft: \"0.1rem\",\n    padding: \"0.2rem\",\n    boxShadow: \"1px 1px 1px #CDCDCD\",\n    borderRadius: \"2px\",\n\n    cursor: \"pointer\",\n  },\n  term: {},\n  score: {},\n}));\nconst SignificantTerm: FunctionComponent<{\n  term: string;\n  score: number;\n  label: string;\n  searchForTerm: (term: string) => void;\n}> = (props) => {\n  const { term } = props;\n  const classes = useStyles();\n  return (\n    <div className={classes.root} onClick={() => props.searchForTerm(term)}>\n      <div className={classes.term}>{term}</div>\n    </div>\n  );\n};\n\nexport default SignificantTerm;\n","import React, { FunctionComponent } from \"react\";\nimport SignificantTerm from \"./SignificantTerm\";\n\nconst SignificantTermsList: FunctionComponent<{\n  terms: { word: string; score: number }[];\n  searchForTerm: (term: string) => void;\n  label: string;\n}> = (props) => {\n  return (\n    <>\n      {props.terms.slice(0, 22).map((ws) => (\n        <SignificantTerm\n          term={ws.word}\n          score={ws.score}\n          label={props.label}\n          searchForTerm={props.searchForTerm}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default SignificantTermsList;\n","import React, { FunctionComponent } from \"react\";\nimport { useQuery } from \"react-query\";\nimport logger from \"../../../../backend/utils/logger\";\nimport SignificantTermsList from \"./SignificantTermsList\";\nimport { ILabelController } from \"../../../../controllers/controllerInterfaces\";\n\nconst SignificantTermsContainer: FunctionComponent<{\n  label: string;\n  labelController: ILabelController;\n  count: number;\n}> = (props) => {\n  const query = useQuery(\n    [\"sigTerms\", props.label, props.count],\n    () => props.labelController.getSignificantTerms(props.label),\n    { cacheTime: 0 }\n  );\n\n  if (query.isLoading === undefined) {\n    return <div>\"calculating\"</div>;\n  }\n  if (query.isError) {\n    return <div> error</div>;\n  }\n  if (!query.data) {\n    return <div> problem {JSON.stringify(query.isSuccess)}</div>;\n  } else {\n    logger({ label: props.label, terms: query.data.terms.slice(10) });\n  }\n  return (\n    <SignificantTermsList\n      label={props.label}\n      searchForTerm={props.labelController.searchForTerm}\n      terms={query.data.terms}\n    />\n  );\n};\n\nexport default SignificantTermsContainer;\n","import React, { FunctionComponent } from \"react\";\nimport { ILabelController } from \"../../../controllers/controllerInterfaces\";\nimport { Checkbox } from \"@material-ui/core\";\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\";\n\ninterface Props {\n  labelName: string;\n  labelController: ILabelController;\n}\n\nconst SelectedLabelToggle: FunctionComponent<Props> = React.memo((props) => {\n  const labelName = props.labelName;\n\n  const handleClickHuman = () => {\n    if (props.labelController.filteredLabel === props.labelName) {\n      // Then we are unselecting\n      props.labelController.changeLabelFilter(null, \"human\");\n    } else {\n      props.labelController.changeLabelFilter(labelName, \"human\");\n    }\n  };\n  const handleClickModel = () => {\n    if (props.labelController.filteredPrediction === props.labelName) {\n      // Then we are unselecting\n      props.labelController.changeLabelFilter(null, \"pred\");\n    } else {\n      props.labelController.changeLabelFilter(labelName, \"pred\");\n    }\n  };\n  return (\n    <span>\n      <FormControlLabel\n        control={\n          <Checkbox\n            checked={props.labelController.filteredLabel === labelName}\n            onChange={handleClickHuman}\n            inputProps={{ \"aria-label\": \"primary checkbox\" }}\n          />\n        }\n        label=\"Labels\"\n      />\n      <FormControlLabel\n        control={\n          <Checkbox\n            checked={props.labelController.filteredPrediction === labelName}\n            onChange={handleClickModel}\n            inputProps={{ \"aria-label\": \"primary checkbox\" }}\n            color={\"primary\"}\n          />\n        }\n        label={\"Predictions\"}\n      />\n    </span>\n  );\n});\n\nexport default SelectedLabelToggle;\n","import React, { FunctionComponent } from \"react\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\nimport colorManaer from \"../../utils/labelsetcolors/labelsetcolors\";\nimport SignificantTermsContainer from \"./significantTerms/SignificantTermsContainer\";\nimport SelectedLabelToggle from \"./SelectedLabelToggle\";\nimport { ILabelController } from \"../../../controllers/controllerInterfaces\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    marginBottom: \"2px\",\n    textOverflow: \"ellipsis\",\n    cursor: \"pointer\",\n    padding: theme.spacing(1),\n    marginRight: theme.spacing(1),\n    borderRadius: \"4px\",\n    fontWeight: \"bold\",\n    userSelect: \"none\",\n    fontSize: \"0.75rem\",\n    display: \"inline-block\",\n    width: \"100%\",\n    maxHeight: \"200px\",\n    position: \"relative\",\n    marginTop: \"1rem\",\n    \"&>label\": {\n      padding: \"0.15rem\",\n      background: \"white\",\n      position: \"absolute\",\n      top: \"-1rem\",\n    },\n  },\n  nameContainer: {\n    textTransform: \"uppercase\",\n    fontWeight: \"bold\",\n    fontSize: \"0.75rem\",\n  },\n  termsContainer: {\n    marginTop: \"1rem\",\n\n    border: \"1px solid black\",\n    fontSize: \"10px\",\n    position: \"relative\",\n    display: \"inline-flex\",\n    width: \"100%\",\n    \"flex-wrap\": \"wrap\",\n    \"&>label\": {\n      padding: \"0.15rem\",\n      background: \"white\",\n      position: \"absolute\",\n      top: \"-1rem\",\n\n      fontSize: \"0.7rem\",\n      border: \"1px solid black\",\n      borderBottom: \"none\",\n      borderRadius: \"4px\",\n    },\n  },\n  controlorContainers: {\n    width: \"66%\",\n  },\n  toggleButton: {\n    border: \"0.1rem solid white\",\n    padding: \"0.25rem\",\n    textTransform: \"uppercase\",\n    fontSize: \"0.5rem\",\n  },\n}));\nconst LabelRow: FunctionComponent<{\n  count: number;\n  labelName: string;\n  selected: boolean;\n  labelController: ILabelController;\n  onClick?: (val: string | null) => void;\n  comment?: string;\n}> = React.memo((props) => {\n  const classes = useStyles();\n  const labelName = props.labelName;\n  let style: { border: string; borderColor: string };\n  const color = colorManaer.getLabelColor(labelName);\n  style = React.useMemo(() => {\n    const color = colorManaer.getLabelColor(labelName);\n    return {\n      borderColor: color,\n      border: `1px solid ${color}`,\n    };\n  }, [labelName]);\n\n  const handleClick = () => {\n    if (!props.onClick) {\n      return;\n    }\n    if (props.selected) {\n      props.onClick(null);\n    } else {\n      props.onClick(labelName);\n    }\n  };\n\n  return (\n    <div style={style} className={classes.root} onClick={handleClick}>\n      <label className={classes.nameContainer} style={{ color: color }}>\n        {\" \"}\n        {labelName} - {props.count}{\" \"}\n      </label>\n      <span\n        className={classes.toggleButton}\n        onClick={() =>\n          props.labelController.applyLabelToSearchResults(labelName)\n        }\n      >\n        {\" \"}\n        Label All{\" \"}\n      </span>\n      <SelectedLabelToggle\n        labelName={labelName}\n        labelController={props.labelController}\n      />\n      <span className={classes.termsContainer}>\n        <label>Keywords</label>\n        <SignificantTermsContainer\n          label={labelName}\n          labelController={props.labelController}\n          count={props.count}\n        />\n      </span>\n    </div>\n  );\n});\n\nexport default LabelRow;\n","import React from \"react\";\nimport { useAnnotateAll } from \"../../frontend/components/labelControls/labelControls\";\nimport { useDispatch } from \"react-redux\";\nimport searchSlice from \"../../frontend/QueryContext/searchReducer\";\nimport { ILabelController } from \"../controllerInterfaces\";\nimport { useTypedSelector } from \"../../frontend/redux-state/rootState\";\nimport { IndexWorkerSingleton } from \"../../backend/workers/docIndex/IndexWorkerSingleton\";\n\nexport default function useDefaultLabelController(): ILabelController {\n  const dispatch = useDispatch();\n  const {\n    label: filteredLabel,\n    predictedLabel: filteredPrediction,\n  } = useTypedSelector((state) => state.searchReducer);\n\n  const [applyLabelToSearchResults] = useAnnotateAll();\n  return React.useMemo(() => {\n    const searchForTerm = (term: string) => {\n      dispatch(\n        searchSlice.actions.setSearchParams({\n          params: { searchQuery: term },\n        })\n      );\n    };\n    const changeLabelFilter = (\n      labelName: string | null,\n      source: \"human\" | \"pred\"\n    ) => {\n      const change: Record<string, string | null> = {};\n      if (source === \"human\") {\n        change[\"label\"] = labelName;\n      }\n      if (source === \"pred\") {\n        change[\"predictedLabel\"] = labelName;\n      }\n\n      dispatch(searchSlice.actions.setSearchParams({ params: change }));\n    };\n    return {\n      getSignificantTerms: (labelName) =>\n        IndexWorkerSingleton.getInstance().getSignificantTermsForLabel(\n          labelName\n        ),\n      applyLabelToSearchResults,\n      searchForTerm,\n      changeLabelFilter,\n      filteredLabel,\n      filteredPrediction,\n    };\n  }, [applyLabelToSearchResults, dispatch, filteredLabel, filteredPrediction]);\n}\n","import React, { FunctionComponent } from \"react\";\nimport { TextField } from \"@material-ui/core\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport SaveIcon from \"@material-ui/icons/Save\";\nimport { useMutation } from \"react-query\";\nimport { mainThreadDB } from \"../../../backend/database/database\";\nimport useSearchQuery from \"../../QueryContext/useSearchQuery\";\nimport Data from \"../../../backend/data_clients/datainterfaces\";\nimport useDatabase, {\n  useLabelCount,\n} from \"../../../backend/database/useDatabase\";\nimport LabelRow from \"./LabelRow\";\nimport useDefaultLabelController from \"../../../controllers/labelControllers/DefaultLabelController\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Beacon from \"../Beacon\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\n\nconst AddLabel: FunctionComponent = () => {\n  const labelCount = useLabelCount();\n  const [name, setName] = React.useState<string | undefined>();\n  const [addLabel] = useMutation(async (name: string) => {\n    await mainThreadDB.label.add({ name, kind: \"label\", count: 0 }, name);\n    setName(undefined);\n  });\n\n  return (\n    <div style={{ padding: \"1rem\" }}>\n      <TextField\n        fullWidth={true}\n        label={\"Add a new label\"}\n        value={name}\n        onChange={(e) => setName(e.target.value)}\n        InputProps={{\n          startAdornment: (\n            <InputAdornment position=\"start\">\n              <Beacon show={labelCount.data === 0} />\n            </InputAdornment>\n          ),\n          endAdornment: (\n            <InputAdornment position=\"end\">\n              <IconButton\n                size={\"small\"}\n                disabled={name === undefined}\n                color={name ? \"primary\" : undefined}\n                onClick={() => name && addLabel(name)}\n              >\n                <SaveIcon fontSize={\"small\"} />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n    </div>\n  );\n};\n\nexport function useAnnotateAll() {\n  const exampleIds = useSearchQuery();\n  return useMutation((label: string | null) =>\n    mainThreadDB.transaction(\n      \"rw\",\n      [mainThreadDB.example, mainThreadDB.tfidf, mainThreadDB.vector],\n      async () => {\n        //TODO -- get the rejected labels back into the update\n\n        const labelState: Partial<Data.LabelState> = {\n          label: label || undefined,\n          hasLabel: label !== null ? 1 : -1,\n        };\n\n        await Promise.all(\n          (exampleIds.data || []).map(async (exampleId) => {\n            Promise.all([\n              mainThreadDB.example.update(exampleId, labelState),\n              mainThreadDB.tfidf.update(exampleId, labelState),\n              mainThreadDB.vector.update(exampleId, labelState),\n            ]);\n          })\n        );\n      }\n    )\n  );\n}\n\nconst LabelControls: FunctionComponent = (props) => {\n  const labels = useDatabase(\n    \"labelStats\",\n    \"label\",\n    (db) => db.label.toArray(),\n    undefined\n  );\n  const labelController = useDefaultLabelController();\n  if (!labels.data) {\n    return <div>loading</div>;\n  }\n  return (\n    <>\n      <Typography gutterBottom variant={\"h4\"}>\n        Labels\n      </Typography>\n      <AddLabel />\n      <div\n        style={{\n          flexWrap: \"wrap\",\n          display: \"flex\",\n          width: \"100%\",\n          maxHeight: \"95%\",\n          overflowY: \"auto\",\n          marginTop: \"1rem\",\n        }}\n      >\n        {labels.data.map((label, count) => (\n          <LabelRow\n            labelController={labelController}\n            selected={false}\n            count={label.count}\n            labelName={label.name}\n            key={label.name}\n          />\n        ))}\n      </div>\n    </>\n  );\n};\n\nexport default LabelControls;\n","import useDatabase from \"../../backend/database/useDatabase\";\nimport { sortBy } from \"lodash\";\n\nfunction useActiveLearning() {\n  const query = useDatabase(\n    [\"examples\", \"forAL\"],\n    \"example\",\n    async (db) => {\n      const collection = await db.example.where({\n        hasLabel: -1,\n        hasPrediction: 1,\n      });\n      let items = await collection.toArray();\n      items = sortBy(items, (x) => (x.confidence ? -1 * x.confidence : 0));\n      return { size: collection.count(), items };\n    },\n    undefined\n  );\n  return query;\n}\n\nexport default useActiveLearning;\n","import React, { FunctionComponent } from \"react\";\nimport useActiveLearning from \"./useActiveLearning\";\nimport Data from \"../../backend/data_clients/datainterfaces\";\n\ninterface IContext {\n  currentExample: Data.Example | undefined;\n  goToNext: () => void;\n}\n\nexport const ActiveLearningContext = React.createContext<IContext>(null as any);\n\nconst ActiveLearningContextProvider: FunctionComponent = (props) => {\n  const activeLearningExamplesQuery = useActiveLearning();\n  const [currentExample, setCurrentExample] = React.useState<\n    Data.Example | undefined\n  >(undefined);\n  const [currentCursor, setCurrentCursor] = React.useState<number>(0);\n  const activeLearningExamples = activeLearningExamplesQuery.data?.items;\n\n  React.useEffect(() => {\n    setCurrentCursor(0);\n    if (\n      currentCursor === 0 &&\n      currentExample === undefined &&\n      activeLearningExamples !== undefined\n    ) {\n      setCurrentExample(activeLearningExamples[currentCursor]);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [activeLearningExamples]);\n\n  const goToNext = () => {\n    const nextCursor = currentCursor + 1;\n    setCurrentCursor(nextCursor);\n    if (activeLearningExamples) {\n      setCurrentExample(activeLearningExamples[nextCursor]);\n    } else {\n      setCurrentExample(undefined);\n    }\n  };\n  const value = React.useMemo(\n    () => ({\n      goToNext,\n      currentExample,\n    }),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [currentExample]\n  );\n\n  return (\n    <ActiveLearningContext.Provider value={value}>\n      {props.children}\n    </ActiveLearningContext.Provider>\n  );\n};\n\nexport default ActiveLearningContextProvider;\n","export default function() {\n  return new Worker(__webpack_public_path__ + \"static/js/ai_worker.bundle.worker.js\");\n}\n","import { GenericWorkerTypes } from \"../common/datatypes\";\n\nnamespace NSAIWorker {\n  export enum AIRequestMessageKind {\n    startVectorize = \"startVectorize\",\n    startFitPredict = \"startFitPredict\",\n    startValidation = \"startValidation\",\n  }\n\n  export enum AIResponseMessageKind {\n    endVectorize = \"endVectorize\",\n    endFitPredict = \"endFitPredict\",\n    endValidation = \"endValidation\",\n  }\n\n  export enum AIUpdateMessageKind {\n    updateVectorize = \"updateVectorize\",\n    updateFitPredict = \"updateFitPredict\",\n    updateValidation = \"updateValidation\",\n  }\n\n  interface AIEventBase extends GenericWorkerTypes.GenericEvent {\n    workerName: GenericWorkerTypes.EWorkerName.ai;\n    requestId: number;\n    payload: unknown;\n  }\n\n  type RequestEvent = AIEventBase &\n    GenericWorkerTypes.RequestEvent & {\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request;\n    };\n  type ResponseEvent = AIEventBase &\n    GenericWorkerTypes.ResponseEvent & {\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.response;\n    };\n\n  type UpdateEvent = AIEventBase &\n    GenericWorkerTypes.UpdateEvent & {\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.update;\n      kind: AIUpdateMessageKind;\n    };\n\n  export namespace Request {\n    export interface IStartVectorize extends RequestEvent {\n      kind: AIRequestMessageKind.startVectorize;\n      payload: {\n        method: \"tfidf\" | \"universalSentenceEncoder\";\n      };\n    }\n\n    export interface IStartValidate extends RequestEvent {\n      kind: AIRequestMessageKind.startValidation;\n      payload: {};\n    }\n\n    export interface IStartFitPredict extends RequestEvent {\n      kind: AIRequestMessageKind.startFitPredict;\n      payload: {};\n    }\n\n    export type AIWorkerRequests =\n      | IStartFitPredict\n      | IStartValidate\n      | IStartVectorize;\n  }\n\n  export namespace Response {\n    export interface IEndVectorize extends ResponseEvent {\n      kind: AIResponseMessageKind.endVectorize;\n      payload: {};\n    }\n\n    export interface IEndValidate extends ResponseEvent {\n      kind: AIResponseMessageKind.endValidation;\n      payload: {};\n    }\n\n    export interface IEndFitPredict extends ResponseEvent {\n      kind: AIResponseMessageKind.endFitPredict;\n      payload: {};\n    }\n\n    export type Responses = IEndVectorize | IEndValidate | IEndFitPredict;\n  }\n  export namespace Update {\n    interface UpdatePayload {\n      total: number;\n      done: number;\n      remaining: number;\n      pctRemaining: number;\n    }\n\n    export interface IEndVectorize extends UpdateEvent {\n      kind: AIUpdateMessageKind.updateVectorize;\n      payload: UpdatePayload;\n    }\n\n    export interface IUpdateValidate extends UpdateEvent {\n      kind: AIUpdateMessageKind.updateValidation;\n      payload: UpdatePayload;\n    }\n\n    export interface IUpdateFirPredict extends UpdateEvent {\n      kind: AIUpdateMessageKind.updateFitPredict;\n      payload: UpdatePayload;\n    }\n  }\n}\n\nexport default NSAIWorker;\n","import WorkerSingletonBase from \"../common/BaseWorker\";\nimport Worker from \"worker-loader!./ai_worker\";\nimport NSAIWorker from \"./aiWorkerTypes\";\nimport { GenericWorkerTypes } from \"../common/datatypes\";\n\nclass AIWorkerSingleton extends WorkerSingletonBase {\n  workerName: GenericWorkerTypes.EWorkerName.ai;\n  training: boolean;\n\n  private constructor() {\n    super(new Worker());\n    this.workerName = GenericWorkerTypes.EWorkerName.ai;\n    this.training = false;\n  }\n\n  static getInstance(): AIWorkerSingleton {\n    if (this.instance === undefined) {\n      this.instance = new AIWorkerSingleton();\n    }\n\n    return this.instance as AIWorkerSingleton;\n  }\n\n  private beginVectorization(\n    method: NSAIWorker.Request.IStartVectorize[\"payload\"][\"method\"]\n  ) {\n    const event: NSAIWorker.Request.IStartVectorize = {\n      workerName: this.workerName,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      kind: NSAIWorker.AIRequestMessageKind.startVectorize,\n      payload: {\n        method,\n      },\n      requestId: this.nextRequestId(),\n    };\n    this.startWork(event);\n    return this.registerResponseHandler<NSAIWorker.Response.IEndVectorize>(\n      event.requestId\n    );\n  }\n\n  public beginUniversalVectorizer() {\n    return this.beginVectorization(\"universalSentenceEncoder\");\n  }\n\n  public beginTfidfVectorizer() {\n    return this.beginVectorization(\"tfidf\");\n  }\n\n  public beginValidation() {\n    const event: NSAIWorker.Request.IStartValidate = {\n      workerName: this.workerName,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      kind: NSAIWorker.AIRequestMessageKind.startValidation,\n      payload: {},\n      requestId: this.nextRequestId(),\n    };\n    this.startWork(event);\n    return this.registerResponseHandler<NSAIWorker.Response.IEndVectorize>(\n      event.requestId\n    );\n  }\n\n  public beginFitPredict() {\n    const event: NSAIWorker.Request.IStartFitPredict = {\n      workerName: this.workerName,\n      direction: GenericWorkerTypes.ERquestOrResponesOrUpdate.request,\n      kind: NSAIWorker.AIRequestMessageKind.startFitPredict,\n      payload: {},\n      requestId: this.nextRequestId(),\n    };\n    this.startWork(event);\n    return this.registerResponseHandler<NSAIWorker.Response.IEndVectorize>(\n      event.requestId\n    );\n  }\n\n  public async afterNewLabel() {\n    if (this.training) {\n      return;\n    }\n    this.training = true;\n    await this.beginFitPredict();\n    // await this.beginValidation();\n    this.training = false;\n  }\n}\n\nexport default AIWorkerSingleton;\n","import { mainThreadDB } from \"./database\";\nimport Data from \"../data_clients/datainterfaces\";\nimport AIWorkerSingleton from \"../workers/aiWorker/AIWorkerSingleton\";\nimport logger from \"../utils/logger\";\n\nexport async function rejectLabel(exampleId: string, label: string) {\n  let example: Data.Example | undefined = await mainThreadDB.example.get(\n    exampleId\n  );\n  let rejectedLabels = new Set<string>(example?.rejectedLabels || []);\n  rejectedLabels.add(label);\n  await mainThreadDB.transaction(\n    \"rw\",\n    [mainThreadDB.example, mainThreadDB.tfidf, mainThreadDB.vector],\n    async () => {\n      const labelState: Partial<Data.LabelState> = {\n        hasNegativeOrRejectedLabel: 1,\n        rejectedLabels: Array.from(rejectedLabels),\n      };\n\n      await mainThreadDB.example.update(exampleId, labelState);\n      await mainThreadDB.tfidf.update(exampleId, labelState);\n      await mainThreadDB.vector.update(exampleId, labelState);\n    }\n  );\n  logger(`rejected label ${label} for example ${exampleId}`);\n  const workerController = AIWorkerSingleton.getInstance();\n  workerController.afterNewLabel();\n\n  return;\n}\n\nexport function applyLabel(exampleId: string, labelName: string) {\n  return mainThreadDB.transaction(\n    \"rw\",\n    [mainThreadDB.example, mainThreadDB.tfidf, mainThreadDB.vector],\n    async () => {\n      const example = await mainThreadDB.example.get(exampleId);\n      if (example) {\n        const labelState: Partial<Data.LabelState> = {\n          label: labelName || undefined,\n          hasLabel: labelName !== null ? 1 : -1,\n          hasNegativeOrRejectedLabel:\n            labelName || (example.rejectedLabels || []).length > 0 ? 1 : -1,\n        };\n\n        await Promise.all([\n          mainThreadDB.example.update(exampleId, labelState),\n          mainThreadDB.tfidf.update(exampleId, labelState),\n          mainThreadDB.vector.update(exampleId, labelState),\n        ]);\n      }\n    }\n  );\n}\n","import React, { FunctionComponent } from \"react\";\n\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\n\nimport { ActiveLearningContext } from \"../../active_learning/ActiveLearningContext\";\nimport colorManaer from \"../../utils/labelsetcolors/labelsetcolors\";\nimport AIWorkerSingleton from \"../../../backend/workers/aiWorker/AIWorkerSingleton\";\nimport useDatabase from \"../../../backend/database/useDatabase\";\nimport { applyLabel } from \"../../../backend/database/dbProcesdures\";\nimport Data from \"../../../backend/data_clients/datainterfaces\";\n\ninterface Props {\n  exampleId: string;\n}\n\nconst useStyles = makeStyles((theme) => ({\n  cbRoot: {\n    display: \"inline\",\n    width: \"fit-content\",\n    maxWidth: \"20%\",\n    textOverflow: \"ellipsis\",\n    cursor: \"pointer\",\n    padding: theme.spacing(1),\n    marginRight: theme.spacing(1),\n    borderRadius: \"4px\",\n    fontWeight: \"bold\",\n    userSelect: \"none\",\n  },\n}));\nconst ClassBox: FunctionComponent<{\n  labelName: string;\n  selected: boolean;\n  onClick?: (val: string | null) => void;\n  comment?: string;\n}> = React.memo((props) => {\n  const classes = useStyles();\n  const labelName = props.labelName;\n  const style = React.useMemo(() => {\n    const color = colorManaer.getLabelColor(labelName);\n    if (props.selected) {\n      return {\n        background: color,\n        color: \"white\",\n      };\n    } else {\n      return {\n        borderColor: color,\n        color: color,\n        border: \"1px solid\",\n      };\n    }\n  }, [labelName, props.selected]);\n\n  const activeLearningContext = React.useContext(ActiveLearningContext);\n\n  const handleClick = () => {\n    if (!props.onClick) {\n      return;\n    }\n    if (props.selected) {\n      props.onClick(null);\n    } else {\n      props.onClick(labelName);\n      const workerController = AIWorkerSingleton.getInstance();\n      workerController.afterNewLabel();\n      if (activeLearningContext) {\n        activeLearningContext.goToNext();\n      }\n    }\n  };\n  return (\n    <div\n      onKeyDown={(e) => {\n        if (e.key === \"Enter\" || e.keyCode === 32) {\n          handleClick();\n          e.preventDefault();\n        }\n      }}\n      style={style}\n      className={classes.cbRoot}\n      onClick={handleClick}\n    >\n      {labelName} {props.comment ? ` - ${props.comment}` : null}\n    </div>\n  );\n});\nconst ClassificationRibbon: FunctionComponent<Props> = React.memo((props) => {\n  const { exampleId } = props;\n\n  const labels = useDatabase(\n    \"labels\",\n    \"label\",\n    (db) => db.label.toArray(),\n    undefined\n  );\n  const example = useDatabase(\n    [\"exampleLabel\", exampleId],\n    \"example\",\n    (db) => db.example.get(exampleId),\n    props.exampleId\n  );\n\n  if (labels.data && example.data)\n    return (\n      <div>\n        {labels.data.map((label) => (\n          <span\n            style={\n              //@ts-ignore\n              example.data.rejectedLabels.includes(label.name)\n                ? { opacity: 0.3 }\n                : {}\n            }\n          >\n            <ClassBox\n              labelName={label.name}\n              selected={example?.data?.label === label.name}\n              onClick={() =>\n                applyLabel((example.data as Data.Example).exampleId, label.name)\n              }\n            />\n          </span>\n        ))}\n      </div>\n    );\n  else {\n    return null;\n  }\n});\n\nexport default ClassificationRibbon;\n","import React, { FunctionComponent } from \"react\";\n\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Paper } from \"@material-ui/core\";\nimport LabselsetColors from \"../../utils/labelsetcolors/labelsetcolors\";\nimport ClassificationRibbon from \"./ClassificationRibbon\";\n\nimport Typography from \"@material-ui/core/Typography\";\nimport useDatabase from \"../../../backend/database/useDatabase\";\nimport { ActiveLearningContext } from \"../../active_learning/ActiveLearningContext\";\nimport { rejectLabel } from \"../../../backend/database/dbProcesdures\";\nimport Divider from \"@material-ui/core/Divider\";\nimport { useTypedSelector } from \"../../redux-state/rootState\";\n\ninterface Props {\n  exampleId: string;\n  score?: number;\n  addSpanId?: (spanId: string) => void;\n  onLoad?: () => void;\n}\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    boxShadow: \"4px 4px 4px #CDCDCD \",\n    margin: theme.spacing(3),\n    padding: theme.spacing(3),\n    lineHeight: \"2.5rem\",\n  },\n  body: {\n    whiteSpace: \"pre-wrap\",\n    fontSize: \"16px\",\n    lineHeight: \"32px\",\n    \"&>em\": {\n      background: \"yellow\",\n      \"&:focus\": {\n        fontWeight: \"bold\",\n      },\n    },\n  },\n  divider: {\n    margin: theme.spacing(2, 0),\n  },\n  ribbon: {\n    height: \"15%\",\n  },\n}));\n\nconst HighlightedBody: FunctionComponent<{ text: string }> = React.memo(\n  (props) => {\n    const searchParams = useTypedSelector((state) => state.searchReducer);\n    let query = searchParams.searchQuery;\n    let text = props.text;\n    const spans: JSX.Element[] = [];\n    if (!query) {\n      spans.push(<span>{props.text}</span>);\n    } else {\n      query = query.toLowerCase();\n      let cursor = text.toLowerCase().search(query);\n\n      while (cursor !== -1) {\n        spans.push(<span>{text.slice(0, cursor)}</span>);\n        const end = cursor + query.length;\n        spans.push(<em tabIndex={0}>{text.slice(cursor, end)}</em>);\n        text = text.slice(end);\n        cursor = text.search(query);\n      }\n      spans.push(<span>{text}</span>);\n    }\n    return <> {spans} </>;\n  }\n);\n\nconst Example: FunctionComponent<Props> = (props) => {\n  const classes = useStyles();\n  const exampleQuery = useDatabase(\n    [\"example\", props.exampleId],\n    \"example\",\n    (db) => db.example.get(props.exampleId),\n    props.exampleId\n  );\n  const activeLearningContext = React.useContext(ActiveLearningContext);\n  React.useEffect(() => {\n    props.onLoad && props.onLoad();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [exampleQuery.data]);\n  if (exampleQuery.data) {\n    return (\n      <Paper\n        className={classes.root}\n        style={{\n          border: exampleQuery.data?.predictedLabel\n            ? `1px solid ${LabselsetColors.getLabelColor(\n                exampleQuery.data.predictedLabel\n              )}`\n            : undefined,\n        }}\n      >\n        <div className={classes.ribbon}>\n          <Typography variant={\"subtitle1\"} color={\"primary\"}>\n            {props.score || null}\n          </Typography>\n          <ClassificationRibbon exampleId={props.exampleId} />\n        </div>\n        <Divider className={classes.divider} />\n        <div\n          style={{ fontWeight: \"bold\" }}\n          onClick={() => {\n            if (exampleQuery.data && exampleQuery.data.predictedLabel) {\n              rejectLabel(\n                exampleQuery.data.exampleId,\n                exampleQuery.data.predictedLabel\n              );\n              if (activeLearningContext) {\n                activeLearningContext.goToNext();\n              }\n            }\n          }}\n        >\n          {\" \"}\n          {exampleQuery.data?.predictedLabel || null}{\" \"}\n          {exampleQuery.data?.confidence?.toLocaleString(\"en\", {\n            style: \"percent\",\n          }) || null}\n        </div>\n        <Typography className={classes.body} dir={\"auto\"}>\n          <HighlightedBody text={exampleQuery.data.content} />\n        </Typography>\n      </Paper>\n    );\n  } else {\n    return <div>HI</div>;\n  }\n};\n\nexport default Example;\n","import React, { FunctionComponent } from \"react\";\nimport { ActiveLearningContext } from \"./ActiveLearningContext\";\nimport Example from \"../components/example/Example\";\nimport { Button } from \"@material-ui/core\";\nimport { applyLabel, rejectLabel } from \"../../backend/database/dbProcesdures\";\n\nconst ActiveLearningBody: FunctionComponent = () => {\n  const ref = React.useRef<HTMLDivElement>(null);\n  const context = React.useContext(ActiveLearningContext);\n  React.useEffect(() => {\n    if (ref.current) {\n      ref.current.focus();\n    }\n  });\n  if (!context) {\n    return <div>Not in an active learning context</div>;\n  }\n  if (context.currentExample === undefined) {\n    return <div>No example in context</div>;\n  }\n\n  const onKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (context.currentExample && context.currentExample.predictedLabel) {\n      if (e.key === \"x\") {\n        rejectLabel(\n          context.currentExample.exampleId,\n          context.currentExample.predictedLabel\n        );\n        context.goToNext();\n      }\n      if (e.key === \"a\") {\n        applyLabel(\n          context.currentExample.exampleId,\n          context.currentExample.predictedLabel\n        );\n        context.goToNext();\n      }\n    }\n  };\n  return (\n    <div ref={ref} onKeyDown={onKeyDown} tabIndex={0}>\n      <Example score={1} exampleId={context.currentExample.exampleId} />;\n      <Button onClick={context.goToNext}>Skip</Button>\n    </div>\n  );\n};\n\nexport default ActiveLearningBody;\n","import React, { FunctionComponent } from \"react\";\nimport Button from \"@material-ui/core/Button\";\nimport AIWorkerSingleton from \"../../backend/workers/aiWorker/AIWorkerSingleton\";\nimport { Fade } from \"@material-ui/core\";\nimport LinearProgress from \"@material-ui/core/LinearProgress\";\n\nconst aiWorkerSingleton = AIWorkerSingleton.getInstance();\nconst WorkComp: FunctionComponent = () => {\n  const [working, setWorking] = React.useState<boolean>(false);\n  const calculateTFIDF = async () => {\n    setWorking(true);\n    await aiWorkerSingleton.beginTfidfVectorizer();\n    setWorking(false);\n  };\n  const vectorize = async () => {\n    setWorking(true);\n    await aiWorkerSingleton.beginUniversalVectorizer();\n    setWorking(false);\n  };\n  const trainSVM = async () => {\n    setWorking(true);\n    await aiWorkerSingleton.beginFitPredict();\n    await setWorking(false);\n  };\n\n  const validateModel = async () => {\n    setWorking(true);\n    await aiWorkerSingleton.beginValidation();\n    setWorking(false);\n  };\n\n  return (\n    <>\n      <Button disabled={working} onClick={calculateTFIDF}>\n        Calculate TFIDF\n      </Button>\n      <Button disabled={working} onClick={vectorize}>\n        Vectorize\n      </Button>\n      <Button disabled={working} onClick={trainSVM}>\n        Train SVM\n      </Button>\n      <Button disabled={working} onClick={validateModel} color={\"primary\"}>\n        Val\n      </Button>\n      <Fade in={working}>\n        <LinearProgress variant={\"indeterminate\"} />\n      </Fade>\n    </>\n  );\n};\n\nexport default WorkComp;\n","import React from \"react\";\nimport {\n  AutoSizer,\n  CellMeasurer,\n  CellMeasurerCache,\n  List,\n  ListRowProps,\n} from \"react-virtualized\";\nimport Example from \"../example/Example\";\n\nconst cache = new CellMeasurerCache({\n  fixedWidth: true,\n});\nconst ExampleRenderer: React.FunctionComponent<{\n  exampleId: string;\n  virtualizedRowProps: ListRowProps;\n}> = (props) => (\n  <CellMeasurer\n    cache={cache}\n    columnIndex={0}\n    key={props.virtualizedRowProps.key}\n    parent={props.virtualizedRowProps.parent}\n    rowIndex={props.virtualizedRowProps.index}\n  >\n    {({ measure }) => (\n      <div style={props.virtualizedRowProps.style}>\n        <Example\n          key={props.exampleId}\n          exampleId={props.exampleId}\n          onLoad={measure}\n        />\n      </div>\n    )}\n  </CellMeasurer>\n);\nconst ExampleInfiniteScroll: React.FunctionComponent<{\n  exampleIds: string[];\n}> = (props) => {\n  const examples = props.exampleIds;\n  return (\n    <AutoSizer>\n      {({ height, width }) => (\n        <List\n          rowHeight={cache.rowHeight}\n          rowCount={examples.length}\n          width={width}\n          height={height}\n          rowRenderer={(renderProps) => (\n            <ExampleRenderer\n              virtualizedRowProps={renderProps}\n              exampleId={props.exampleIds[renderProps.index]}\n            />\n          )}\n          deferredMeasurementCache={cache}\n        />\n      )}\n    </AutoSizer>\n  );\n};\n\nexport default ExampleInfiniteScroll;\n","import * as Papa from \"papaparse\";\n\nconst readCsvFile = (file: File) => {\n  return new Promise<Papa.ParseResult<any>>((resolve, reject) => {\n    const parseConfig: Papa.ParseConfig = {\n      worker: false,\n      //@ts-ignore\n      headerPlacement: true,\n      dynamicTyping: true,\n      complete: (result) => resolve(result),\n      error: (error) => reject(error.message),\n      skipEmptyLines: true,\n      header: true,\n    };\n    Papa.parse(file, parseConfig);\n  });\n};\nconst readJSONAsynch = (file: File) => {\n  return new Promise<Array<any>>((resolve, reject) => {\n    let reader = new FileReader();\n    reader.onload = () => {\n      try {\n        const str = reader.result as string;\n        const json = JSON.parse(str);\n        if (!Array.isArray(json)) {\n          // PARSE returns something with type object that has length. So this checks if\n          // we got the right thing\n          reject(\n            \"The JSON you uploaded is a single object. Please convert it to an array of objects, one per example\"\n          );\n        } else {\n          resolve(json);\n        }\n      } catch (e) {\n        reject(\"This JSON has errors. Please validate the JSON and try again\");\n      }\n    };\n    reader.readAsText(file);\n  });\n};\nexport const readUserInputFile = async (file: File) => {\n  let data: any[];\n  if (file.name.endsWith(\"json\")) {\n    data = await readJSONAsynch(file);\n  } else {\n    const papaParseResult = await readCsvFile(file);\n    data = papaParseResult.data;\n  }\n  return data;\n};\n","import React, { FunctionComponent, SyntheticEvent } from \"react\";\nimport { Button, TextField } from \"@material-ui/core\";\nimport { readUserInputFile } from \"./fileReader\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport md5 from \"crypto-js/md5\";\nimport { addExamples } from \"../../redux-state/examples/exampleState\";\nimport Data from \"../../../backend/data_clients/datainterfaces\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\nimport { useMutation } from \"react-query\";\nimport Fade from \"@material-ui/core/Fade\";\nimport LinearProgress from \"@material-ui/core/LinearProgress\";\n\nconst saveExamplesfn = (params: {\n  data: any[] | undefined;\n  key: string | undefined;\n  labelKey: string | undefined;\n}) => {\n  const { data, key, labelKey } = params;\n  const examplesArr: Data.Example[] = [];\n  if (data && key) {\n    data.forEach((ex) => {\n      const metadata = { ...ex };\n      delete metadata[key];\n      examplesArr.push({\n        content: ex[key],\n\n        datasetName: \"test\",\n        exampleId: md5(ex[key]).toString(),\n        label: labelKey ? ex[labelKey] : undefined,\n        hasLabel: labelKey && ex[labelKey] ? 1 : -1,\n        kind: \"example\",\n        hasNegativeOrRejectedLabel: -1,\n        rejectedLabels: [],\n        metadata,\n      });\n    });\n  }\n  return addExamples(examplesArr);\n};\nconst FileUploadButton: FunctionComponent<{\n  afterSubmit?: () => void;\n}> = (props) => {\n  const inputRef = React.useRef<HTMLInputElement>(null);\n  const [keys, setKeys] = React.useState<string[]>();\n  const [key, setKey] = React.useState<string>();\n  const [labelKey, setLabelKey] = React.useState<string | undefined>();\n  const [data, setData] = React.useState<any[]>();\n  const [saveExamples, saveStatus] = useMutation(saveExamplesfn);\n  const handleFile = async (e: SyntheticEvent) => {\n    e.preventDefault();\n    if (inputRef) {\n      if (inputRef.current) {\n        if (inputRef.current.files) {\n          const file = inputRef.current.files[0];\n          if (file) {\n            const res = await readUserInputFile(inputRef.current.files[0]);\n            setData(res);\n            setKeys(Object.keys(res[0]));\n            props.afterSubmit && props.afterSubmit();\n          }\n        }\n      }\n    }\n  };\n  return (\n    <Grid container spacing={4}>\n      <Grid item xs={12}>\n        <input\n          ref={inputRef}\n          accept=\"text/csv, text/tsv, .csv,.tsv, .json\"\n          onChange={handleFile}\n          style={{ display: \"none\" }}\n          id=\"csv-file\"\n          multiple\n          type=\"file\"\n        />\n        <label htmlFor=\"csv-file\">\n          <Button\n            fullWidth={true}\n            variant={\"outlined\"}\n            component=\"span\"\n            color={\"primary\"}\n          >\n            Add A CSV\n          </Button>\n        </label>\n      </Grid>\n      <Grid item xs={12}>\n        <TextField\n          required={true}\n          fullWidth={true}\n          disabled={!keys}\n          onChange={(e) => setKey(e.target.value)}\n          select={true}\n          label={\"Data Column\"}\n          helperText={\"Which column will you be labeling? \"}\n          value={key}\n        >\n          {(keys || []).map((key) => (\n            <MenuItem key={key} value={key}>\n              {key}\n            </MenuItem>\n          ))}\n        </TextField>\n      </Grid>\n      <Grid item xs={12}>\n        <TextField\n          fullWidth={true}\n          disabled={!key}\n          onChange={(e) => setLabelKey(e.target.value)}\n          select={true}\n          label={\"Label Column\"}\n          helperText={\"Is there a column with labels?  \"}\n          value={key}\n        >\n          <MenuItem key={\"empty\"} value={undefined} disabled={false}>\n            <Typography color={\"error\"}> No Labels </Typography>\n          </MenuItem>\n          {(keys || []).map((k) => (\n            <MenuItem key={k} value={k} disabled={k === key}>\n              {k}\n            </MenuItem>\n          ))}\n        </TextField>\n      </Grid>\n\n      <Grid item xs={12}>\n        <Button\n          color={\"primary\"}\n          variant={\"contained\"}\n          disabled={!key || saveStatus.isLoading}\n          onClick={() => saveExamples({ data, key, labelKey })}\n          fullWidth={true}\n        >\n          <Fade in={!saveStatus.isLoading}>\n            <span> Upload </span>\n          </Fade>\n        </Button>\n        <Fade in={saveStatus.isLoading}>\n          <LinearProgress />\n        </Fade>\n      </Grid>\n    </Grid>\n  );\n};\n\nexport default FileUploadButton;\n","import React, { FunctionComponent } from \"react\";\nimport { ButtonProps, DialogTitle } from \"@material-ui/core\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport FileUploadButton from \"./simpleDataUpload\";\nimport Button from \"@material-ui/core/Button\";\n\nconst AddDataDialog: FunctionComponent<{\n  open: boolean;\n  onClose: () => void;\n}> = (props) => {\n  return (\n    <Dialog open={props.open} onClose={props.onClose}>\n      <DialogTitle>Add Data</DialogTitle>\n      <DialogContent>\n        <FileUploadButton />\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport const AddDataDialogWithButton: FunctionComponent<{\n  buttonProps?: ButtonProps;\n  label: string;\n}> = (props) => {\n  const [open, setOpen] = React.useState<boolean>(false);\n  return (\n    <>\n      <Button {...props.buttonProps} onClick={() => setOpen(true)}>\n        {props.label}\n      </Button>\n      <AddDataDialog open={open} onClose={() => setOpen(false)} />\n    </>\n  );\n};\nexport default AddDataDialog;\n","import React, { FunctionComponent } from \"react\";\nimport ThreeColumnBody from \"./templates/ThreeColumnBody\";\nimport LabelControls from \"../labelControls/labelControls\";\nimport useSearchQuery from \"../../QueryContext/useSearchQuery\";\nimport ActiveLearningContextProvider from \"../../active_learning/ActiveLearningContext\";\nimport ActiveLearningBody from \"../../active_learning/ActiveLearningBody\";\nimport { useTypedSelector } from \"../../redux-state/rootState\";\nimport { Fade } from \"@material-ui/core\";\nimport Typography from \"@material-ui/core/Typography\";\nimport WorkComp from \"../../classifier/workerComp\";\nimport ExampleInfiniteScroll from \"./ExampleInfiniteScroll\";\nimport { AddDataDialogWithButton } from \"../dataUpload/AddDataDialog\";\n\nconst NoDataBody = () => {\n  return (\n    <div style={{ width: \"400px\", margin: \"auto\" }}>\n      <Typography variant={\"h3\"} gutterBottom>\n        No Results\n      </Typography>\n      <Typography variant={\"h5\"} gutterBottom>\n        We searched hard, but the current query doesn't have any matches\n      </Typography>\n    </div>\n  );\n};\n\nconst RegularBody: FunctionComponent = () => {\n  const exampleIds = useSearchQuery();\n  const data = exampleIds.data || [];\n\n  return (\n    <>\n      <Fade in={exampleIds.isLoading}>\n        <div>Loading</div>\n      </Fade>\n      <Fade\n        in={exampleIds.isSuccess && data.length > 0}\n        mountOnEnter\n        unmountOnExit\n      >\n        <ExampleInfiniteScroll exampleIds={data} />\n      </Fade>\n      <Fade\n        in={exampleIds.isSuccess && data.length === 0}\n        mountOnEnter\n        unmountOnExit\n      >\n        <NoDataBody />\n      </Fade>\n    </>\n  );\n};\nconst BodyDispatch: FunctionComponent = () => {\n  const mode = useTypedSelector((state) => state.appMode.mode);\n  const isActiveLearning = mode === \"ActiveLearning\";\n\n  return (\n    <div\n      style={{\n        height: \"100%\",\n        padding: \"2rem\",\n        maxHeight: \"100%\",\n        overflowY: \"auto\",\n      }}\n    >\n      {isActiveLearning ? (\n        <ActiveLearningContextProvider>\n          <ActiveLearningBody />\n        </ActiveLearningContextProvider>\n      ) : (\n        <RegularBody />\n      )}\n    </div>\n  );\n};\nconst OpenAnnotationBody: FunctionComponent = () => {\n  return (\n    <ThreeColumnBody\n      Left={<LabelControls />}\n      Middle={<BodyDispatch />}\n      Right={\n        <div>\n          <WorkComp />{\" \"}\n          <AddDataDialogWithButton\n            label={\"Add Data\"}\n            buttonProps={{ variant: \"contained\", color: \"primary\" }}\n          />\n        </div>\n      }\n    />\n  );\n};\n\nexport default OpenAnnotationBody;\n","import React, { FunctionComponent } from \"react\";\nimport Typography from \"@material-ui/core/Typography\";\nimport ThreeColumnBody from \"./templates/ThreeColumnBody\";\nimport { Paper } from \"@material-ui/core\";\nimport ComputerIcon from \"@material-ui/icons/Computer\";\nimport CategoryIcon from \"@material-ui/icons/Category\";\nimport DescriptionIcon from \"@material-ui/icons/Description\";\nimport SearchIcon from \"@material-ui/icons/Search\";\nimport DoneIcon from \"@material-ui/icons/GetApp\";\nimport LockIcon from \"@material-ui/icons/Lock\";\nimport GithubIcon from \"@material-ui/icons/GitHub\";\n\nimport Grid from \"@material-ui/core/Grid\";\nimport Button from \"@material-ui/core/Button\";\nimport AddDataDialog from \"../dataUpload/AddDataDialog\";\n\nconst WelcomeItem: FunctionComponent<{\n  title: string;\n  subtitle: string;\n  Icon?: typeof CategoryIcon;\n}> = (props) => (\n  <Grid item xs={6}>\n    <Paper style={{ padding: \"1rem\" }}>\n      <Grid\n        container\n        alignItems={\"center\"}\n        spacing={2}\n        justify={\"space-between\"}\n      >\n        <Grid item xs={1}>\n          {props.Icon ? <props.Icon fontSize={\"large\"} /> : null}\n        </Grid>\n        <Grid item xs={10}>\n          <Typography variant={\"h4\"}>{props.title}</Typography>\n        </Grid>\n\n        <Grid item xs={12}>\n          <label style={{ fontSize: \"16px\" }}>{props.subtitle} </label>\n        </Grid>\n      </Grid>\n    </Paper>\n  </Grid>\n);\nconst WelcomeText: FunctionComponent = () => {\n  const [openDialog, setOpen] = React.useState<boolean>(false);\n  return (\n    <Grid\n      container\n      spacing={4}\n      style={{ padding: \"2rem\", margin: \"-16px -32px\" }}\n    >\n      <Grid item xs={6}>\n        <Typography color=\"primary\" variant={\"h3\"}>\n          Welcome To YLabel\n        </Typography>\n      </Grid>\n      <Grid item xs={6}>\n        <Button\n          variant={\"contained\"}\n          color={\"primary\"}\n          fullWidth={true}\n          onClick={() => setOpen(true)}\n        >\n          <Typography align=\"center\" variant={\"h4\"}>\n            Start Categorizing\n          </Typography>\n        </Button>\n      </Grid>\n      <WelcomeItem\n        title={\"Categorize Documents\"}\n        subtitle={\"YLabel can help you categorize documents\"}\n        Icon={CategoryIcon}\n      />\n      <WelcomeItem\n        title={\"Customizable\"}\n        subtitle={\"YLabel works on your data and your categories. \"}\n        Icon={DescriptionIcon}\n      />\n      <WelcomeItem\n        title={\"Search\"}\n        subtitle={\"Use the search bar to find similar documents at once\"}\n        Icon={SearchIcon}\n      />\n      <WelcomeItem\n        title={\"Automation\"}\n        subtitle={\"YLabel learns from you and provides predictions\"}\n        Icon={ComputerIcon}\n      />\n      <WelcomeItem\n        title={\"Active Learning\"}\n        subtitle={\n          \"YLabel can tell you what to label so that it can learn faster and automate better\"\n        }\n        Icon={ComputerIcon}\n      />\n      <WelcomeItem\n        title={\"Download\"}\n        subtitle={\n          \"When you're done, click download to get back your labels and model predictions in a CSV\"\n        }\n        Icon={DoneIcon}\n      />\n      <WelcomeItem\n        title={\"Secure\"}\n        subtitle={\n          \"Your data never leaves your computer. YLabel runs the machine learning and search on your machine. \"\n        }\n        Icon={LockIcon}\n      />\n      <WelcomeItem\n        title={\"Open Source\"}\n        subtitle={\n          \"YLabel is free and open source. Fork the repo, extend it and help the community make it even better\"\n        }\n        Icon={GithubIcon}\n      />\n      <AddDataDialog open={openDialog} onClose={() => setOpen(false)} />\n    </Grid>\n  );\n};\n\nconst WelcomeLayout: FunctionComponent = () => {\n  return (\n    <ThreeColumnBody\n      Middle={<WelcomeText />}\n      Left={<div></div>}\n      Right={<div></div>}\n    />\n  );\n};\n\nexport default WelcomeLayout;\n","import React, { FunctionComponent } from \"react\";\nimport useDatabase from \"../../../backend/database/useDatabase\";\nimport OpenAnnotationBody from \"./OpenAnnotationBodyLayout\";\nimport WelcomeLayout from \"./WelcomeLayout\";\n\nconst LayoutDispatch: FunctionComponent = () => {\n  const exampleCount = useDatabase(\n    \"exampleCount\",\n    \"example\",\n    (db) => db.example.count(),\n    undefined\n  );\n  if (exampleCount.data) {\n    return <OpenAnnotationBody />;\n  } else {\n    return <WelcomeLayout />;\n  }\n};\n\nexport default LayoutDispatch;\n","import React from \"react\";\nimport { Provider } from \"react-redux\";\nimport \"typeface-roboto\";\nimport { QueryCache, ReactQueryCacheProvider } from \"react-query\";\nimport \"react-reflex/styles.css\";\nimport { CssBaseline } from \"@material-ui/core\";\nimport store from \"./frontend/redux-state/rootState\";\nimport createMuiTheme from \"@material-ui/core/styles/createMuiTheme\";\nimport { ThemeProvider } from \"@material-ui/core/styles\";\nimport PrimarySearchAppBar from \"./frontend/components/appBar/Appbar\";\nimport LayoutDispatch from \"./frontend/components/layouts/LayoutDispatch\";\nimport makeStyles from \"@material-ui/core/styles/makeStyles\";\n\nconst theme = createMuiTheme({\n  typography: {\n    fontSize: 10,\n    fontFamily: \"Roboto\",\n  },\n});\n\nconst cache = new QueryCache();\nconst useStyles = makeStyles(() => ({\n  \"@global\": {\n    \"*:focus\": {\n      outline: 0,\n    },\n    //don't use the browsers outline for selected stuff\n  },\n}));\nexport function App() {\n  const classes = useStyles();\n  return (\n    <Provider store={store}>\n      <ReactQueryCacheProvider queryCache={cache}>\n        <ThemeProvider theme={theme}>\n          <CssBaseline classes={classes} />\n          <PrimarySearchAppBar />\n          <LayoutDispatch />\n        </ThemeProvider>\n      </ReactQueryCacheProvider>\n    </Provider>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { IndexWorkerSingleton } from \"./backend/workers/docIndex/IndexWorkerSingleton\";\nimport { mainThreadDB } from \"./backend/database/database\";\n\nconst indexWorkerSingleton = IndexWorkerSingleton.getInstance();\nindexWorkerSingleton\n  .initializeIndex()\n  .then(() => {})\n  .catch((err) => {});\n//TODO this is a workaround remove this\nmainThreadDB.label.offset(12).delete();\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(logger))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}